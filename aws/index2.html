User: test
Model: Hello! I'm working and ready to help you. What would you like to test or discuss?
User: AWS 차세대 보안 아키텍쳐 설계 가이드
Model: # AWS 차세대 보안 아키텍쳐 설계 가이드

AWS 클라우드 환경에서 현대적이고 강력한 보안 아키텍쳐를 구축하기 위한 포괄적인 가이드를 제공합니다.

## 1. 핵심 보안 원칙

### Zero Trust 아키텍쳐
- **원칙**: "절대 신뢰하지 말고, 항상 검증하라"
- 네트워크 위치와 관계없이 모든 접근 요청 검증
- 최소 권한 원칙(Least Privilege) 적용

### Defense in Depth (다층 방어)
- 여러 보안 계층 구축
- 단일 실패 지점 제거
- 각 계층별 독립적인 보안 통제

## 2. 계정 및 조직 보안

### AWS Organizations 구조
```
Root OU
├── Security OU
│   ├── Log Archive Account
│   └── Security Tooling Account
├── Infrastructure OU
│   ├── Network Account
│   └── Shared Services Account
└── Workload OU
    ├── Production Account
    ├── Staging Account
    └── Development Account
```

### 주요 설정
- **SCP (Service Control Policies)** 적용
- **AWS Control Tower** 활용한 거버넌스 자동화
- 계정별 역할 분리 (RBAC)

## 3. 네트워크 보안 아키텍쳐

### VPC 설계
```
Internet Gateway
       ↓
[Public Subnet - ALB/NLB]
       ↓
[Private Subnet - Application]
       ↓
[Isolated Subnet - Database]
```

### 핵심 구성요소

**AWS Network Firewall**
- 상태 저장 방화벽
- IDS/IPS 기능
- Domain 필터링

**Security Groups & NACLs**
- Security Groups: 상태 저장, 인스턴스 레벨
- NACLs: 상태 비저장, 서브넷 레벨

**VPC Flow Logs**
- 네트워크 트래픽 모니터링
- CloudWatch Logs 또는 S3로 전송

## 4. 데이터 보호

### 암호화 전략

**전송 중 암호화**
- TLS 1.2 이상 강제
- AWS Certificate Manager(ACM) 활용
- VPN/Direct Connect를 통한 전용 연결

**저장 데이터 암호화**
- AWS KMS를 통한 키 관리
- Customer Managed Keys(CMK) 사용
- 자동 키 로테이션 활성화

### 데이터 분류 및 보호
```yaml
데이터 분류:
  Public: 암호화 선택
  Internal: 서버 측 암호화(SSE)
  Confidential: CMK + 접근 로깅
  Restricted: CMK + VPC Endpoint + 접근 제한
```

## 5. 식별 및 접근 관리 (IAM)

### IAM 모범 사례

**역할 기반 접근**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-bucket/*",
      "Condition": {
        "StringEquals": {
          "aws:PrincipalOrgID": "o-xxxxxxxxx"
        }
      }
    }
  ]
}
```

**권장 구성**
- MFA 필수 활성화
- 루트 계정 사용 금지
- IAM Access Analyzer 활용
- 권한 경계(Permission Boundaries) 설정

### AWS SSO (Identity Center)
- 중앙 집중식 접근 관리
- SAML 2.0 기반 페더레이션
- 임시 자격 증명 사용

## 6. 위협 탐지 및 대응

### 보안 모니터링 스택

**Amazon GuardDuty**
- 지능형 위협 탐지
- VPC Flow Logs, CloudTrail, DNS 로그 분석
- 머신러닝 기반 이상 탐지

**AWS Security Hub**
- 통합 보안 대시보드
- 자동화된 컴플라이언스 점검
- CIS, PCI-DSS 벤치마크

**Amazon Detective**
- 보안 조사 및 분석
- 시각화된 조사 그래프
- 근본 원인 분석

### SIEM 통합 아키텍쳐
```
CloudTrail ──┐
GuardDuty ───┤
Security Hub ├──→ EventBridge ──→ Lambda ──→ SIEM
Config ──────┤                              (Splunk/ELK)
Macie ───────┘
```

## 7. 애플리케이션 보안

### WAF & Shield
```yaml
AWS WAF 규칙:
  - Rate Limiting: 요청 제한
  - SQL Injection: 차단
  - XSS: 크로스 사이트 스크립팅 방어
  - Geo Blocking: 지역별 차단
  - Bot Control: 봇 탐지 및 관리

AWS Shield:
  - Standard: 자동 DDoS 방어
  - Advanced: 고급 DDoS 방어 + SRT 지원
```

### Secrets Management
- **AWS Secrets Manager**: 자격 증명 자동 로테이션
- **Systems Manager Parameter Store**: 구성 데이터 저장
- 애플리케이션 코드에서 하드코딩 금지

## 8. 컴플라이언스 및 거버넌스

### AWS Config 규칙
```
자동 규정 준수 점검:
✓ 암호화되지 않은 EBS 볼륨 탐지
✓ 공개 S3 버킷 식별
✓ 미사용 IAM 자격 증명 탐지
✓ Security Group 개방 포트 점검
```

### 감사 및 로깅
- **CloudTrail**: 모든 API 호출 기록
- **다중 리전 추적** 활성화
- **로그 파일 무결성 검증** 설정
- S3 버킷 암호화 및 MFA Delete 활성화

## 9. 인시던트 대응 플레이북

### 자동화된 대응 시나리오

**예시: 의심스러운 IAM 활동 탐지**
```
GuardDuty 알림
    ↓
EventBridge 규칙 트리거
    ↓
Lambda 함수 실행
    ↓
1. 사용자 격리 (권한 제거)
2. SNS 알림 발송
3. 티켓 생성 (JIRA/ServiceNow)
4. 포렌식 스냅샷 생성
```

### 대응 체크리스트
1. **탐지**: GuardDuty/Security Hub 알림
2. **격리**: 영향받은 리소스 분리
3. **조사**: Detective/CloudWatch Logs 분석
4. **복구**: 안전한 백업에서 복원
5. **사후 검토**: 근본 원인 분석 및 개선

## 10. 서버리스 보안

### Lambda 보안 모범 사례
- **VPC 내 Lambda 실행** (필요시)
- **환경 변수 암호화** (KMS)
- **최소 권한 IAM 역할**
- **리소스 기반 정책** 활용

### API Gateway 보안
```yaml
보안 계층:
  - Lambda Authorizer (커스텀 인증)
  - Cognito User Pools
  - API Keys + Usage Plans
  - Resource Policies
  - WAF 통합
```

## 11. 컨테이너 보안

### EKS 보안 아키텍쳐
```
Pod Security Standards
    ↓
Network Policies (Calico)
    ↓
IRSA (IAM Roles for Service Accounts)
    ↓
Secrets (External Secrets Operator)
    ↓
Image Scanning (ECR)
```

### 주요 도구
- **Amazon ECR Image Scanning**: 취약점 스캔
- **Falco**: 런타임 보안 모니터링
- **OPA/Gatekeeper**: 정책 기반 거버넌스

## 12. 비용 최적화된 보안

### 우선순위 기반 접근
```
필수 (Tier 1):
- IAM + MFA
- CloudTrail
- Security Groups
- Encryption at rest

권장 (Tier 2):
- GuardDuty
- Security Hub
- Config

고급 (Tier 3):
- Macie
- Detective
- Network Firewall
```

## 13. 자동화 및 IaC

### Terraform 예시
```hcl
module "security_baseline" {
  source = "./modules/security"
  
  enable_guardduty    = true
  enable_security_hub = true
  enable_config       = true
  
  cloudtrail_bucket   = "org-audit-logs"
  log_retention_days  = 365
  
  tags = {
    Environment = "Production"
    Compliance  = "PCI-DSS"
  }
}
```

## 14. 지속적인 보안 개선

### DevSecOps 파이프라인
```
Code → SAST → Build → Container Scan → Deploy → DAST → Monitor
       ↓                    ↓                      ↓        ↓
   SonarQube            Trivy/Snyk            OWASP ZAP  GuardDuty
```

### 정기 점검 사항
- [ ] 월간 IAM 권한 검토
- [ ] 분기별 보안 그룹 감사
- [ ] 분기별 재해 복구 훈련
- [ ] 반기별 침투 테스트
- [ ] 연간 아키텍쳐 리뷰

## 15. 참고 리소스

- **AWS Well-Architected Framework** - Security Pillar
- **CIS AWS Foundations Benchmark**
- **NIST Cybersecurity Framework**
- **AWS Security Best Practices Whitepaper**

---

이 가이드를 특정 산업이나 컴플라이언스 요구사항(예: HIPAA, GDPR, 금융권)에 맞춰 더 상세히 설명해드릴까요?
User: 위 내용을 브라우져에서 볼수 있도록 html 파일로 만들어줘
Model: ```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS 차세대 보안 아키텍쳐 설계 가이드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #232F3E 0%, #FF9900 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 3px solid #FF9900;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        nav a {
            color: #232F3E;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: #FF9900;
            color: white;
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
            scroll-margin-top: 80px;
        }

        h2 {
            color: #232F3E;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #FF9900;
        }

        h3 {
            color: #FF9900;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #232F3E;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .architecture-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #FF9900;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ff9900;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th {
            background: #232F3E;
            color: white;
            padding: 12px;
            text-align: left;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li:before {
            content: "☐ ";
            color: #FF9900;
            font-weight: bold;
            margin-right: 10px;
        }

        footer {
            background: #232F3E;
            color: white;
            text-align: center;
            padding: 30px;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #FF9900;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .back-to-top:hover {
            background: #232F3E;
            transform: translateY(-5px);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header h1 {
                font-size: 1.8em;
            }

            main {
                padding: 20px;
            }

            nav ul {
                flex-direction: column;
                align-items: stretch;
            }

            nav a {
                display: block;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🛡️ AWS 차세대 보안 아키텍쳐 설계 가이드</h1>
            <p>클라우드 환경에서 현대적이고 강력한 보안 아키텍쳐 구축을 위한 포괄적 가이드</p>
        </header>

        <nav>
            <ul>
                <li><a href="#principles">보안 원칙</a></li>
                <li><a href="#accounts">계정 관리</a></li>
                <li><a href="#network">네트워크</a></li>
                <li><a href="#data">데이터 보호</a></li>
                <li><a href="#iam">IAM</a></li>
                <li><a href="#detection">위협 탐지</a></li>
                <li><a href="#application">애플리케이션</a></li>
                <li><a href="#compliance">컴플라이언스</a></li>
                <li><a href="#incident">인시던트 대응</a></li>
                <li><a href="#serverless">서버리스</a></li>
                <li><a href="#container">컨테이너</a></li>
                <li><a href="#automation">자동화</a></li>
            </ul>
        </nav>

        <main>
            <!-- Section 1: 핵심 보안 원칙 -->
            <section id="principles">
                <h2>1. 핵심 보안 원칙</h2>
                
                <h3>Zero Trust 아키텍쳐</h3>
                <div class="info-box">
                    <strong>핵심 원칙:</strong> "절대 신뢰하지 말고, 항상 검증하라 (Never Trust, Always Verify)"
                </div>
                <ul>
                    <li>네트워크 위치와 관계없이 모든 접근 요청을 검증</li>
                    <li>최소 권한 원칙(Least Privilege) 엄격 적용</li>
                    <li>마이크로 세그멘테이션을 통한 공격 표면 최소화</li>
                    <li>연속적인 모니터링 및 검증</li>
                </ul>

                <h3>Defense in Depth (다층 방어)</h3>
                <ul>
                    <li>여러 보안 계층을 통한 중첩된 방어 체계 구축</li>
                    <li>단일 실패 지점(Single Point of Failure) 제거</li>
                    <li>각 계층별 독립적인 보안 통제 메커니즘</li>
                    <li>계층 간 상호 보완적 보안 정책</li>
                </ul>
            </section>

            <!-- Section 2: 계정 및 조직 보안 -->
            <section id="accounts">
                <h2>2. 계정 및 조직 보안</h2>
                
                <h3>AWS Organizations 구조</h3>
                <div class="architecture-diagram">Root Organization Unit (OU)
├── Security OU
│   ├── Log Archive Account (중앙 로그 저장소)
│   ├── Security Tooling Account (보안 도구)
│   └── Audit Account (감사 및 컴플라이언스)
│
├── Infrastructure OU
│   ├── Network Account (전사 네트워크 관리)
│   ├── Shared Services Account (공유 서비스)
│   └── DNS Account (Route 53 관리)
│
└── Workload OU
    ├── Production Account (운영 환경)
    ├── Staging Account (스테이징 환경)
    └── Development Account (개발 환경)</div>

                <h3>주요 설정 및 구성</h3>
                <ul>
                    <li><strong>SCP (Service Control Policies)</strong>: 조직 전체에 적용되는 권한 경계 설정</li>
                    <li><strong>AWS Control Tower</strong>: 멀티 어카운트 환경의 거버넌스 자동화</li>
                    <li><strong>계정별 역할 분리 (RBAC)</strong>: 역할 기반 접근 제어 구현</li>
                    <li><strong>통합 빌링</strong>: 비용 가시성 및 예산 관리</li>
                </ul>

                <div class="success-box">
                    <strong>모범 사례:</strong> 환경별(Dev/Stage/Prod), 팀별, 프로젝트별로 AWS 계정을 분리하여 보안 경계를 명확히 합니다.
                </div>
            </section>

            <!-- Section 3: 네트워크 보안 -->
            <section id="network">
                <h2>3. 네트워크 보안 아키텍쳐</h2>
                
                <h3>VPC 설계 패턴</h3>
                <div class="architecture-diagram">Internet Gateway / NAT Gateway
         ↓
[Public Subnet - Tier 1]
  - Application Load Balancer (ALB)
  - NAT Gateway
  - Bastion Host (Session Manager 권장)
         ↓
[Private Subnet - Tier 2]
  - Application Servers (EC2, ECS, EKS)
  - Lambda Functions
  - API Gateway
         ↓
[Isolated Subnet - Tier 3]
  - RDS Databases
  - ElastiCache
  - DocumentDB</div>

                <h3>핵심 네트워크 보안 구성요소</h3>
                
                <h4>AWS Network Firewall</h4>
                <ul>
                    <li>상태 저장(Stateful) 방화벽 규칙 엔진</li>
                    <li>침입 탐지 및 방지 시스템 (IDS/IPS)</li>
                    <li>도메인 기반 필터링 (악성 도메인 차단)</li>
                    <li>Suricata 호환 규칙 지원</li>
                </ul>

                <h4>Security Groups vs NACLs</h4>
                <table>
                    <thead>
                        <tr>
                            <th>특성</th>
                            <th>Security Groups</th>
                            <th>Network ACLs</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>작동 계층</td>
                            <td>인스턴스 레벨</td>
                            <td>서브넷 레벨</td>
                        </tr>
                        <tr>
                            <td>상태</td>
                            <td>Stateful (상태 저장)</td>
                            <td>Stateless (상태 비저장)</td>
                        </tr>
                        <tr>
                            <td>규칙 타입</td>
                            <td>허용 규칙만</td>
                            <td>허용 및 거부 규칙</td>
                        </tr>
                        <tr>
                            <td>평가 순서</td>
                            <td>모든 규칙 평가</td>
                            <td>번호 순서대로 평가</td>
                        </tr>
                    </tbody>
                </table>

                <h4>VPC Flow Logs</h4>
                <div class="code-block">
# VPC Flow Logs 구성 예시
resource "aws_flow_log" "main" {
  log_destination      = aws_s3_bucket.flow_logs.arn
  log_destination_type = "s3"
  traffic_type         = "ALL"
  vpc_id               = aws_vpc.main.id

  tags = {
    Name        = "vpc-flow-logs"
    Environment = "production"
  }
}</div>
            </section>

            <!-- Section 4: 데이터 보호 -->
            <section id="data">
                <h2>4. 데이터 보호</h2>
                
                <h3>암호화 전략</h3>
                
                <h4>전송 중 암호화 (Encryption in Transit)</h4>
                <ul>
                    <li><strong>TLS 1.2 이상 강제</strong>: 모든 데이터 전송 시 TLS 프로토콜 사용</li>
                    <li><strong>AWS Certificate Manager (ACM)</strong>: SSL/TLS 인증서 자동 관리</li>
                    <li><strong>VPN / Direct Connect</strong>: 온프레미스와의 안전한 연결</li>
                    <li><strong>PrivateLink</strong>: AWS 서비스에 대한 프라이빗 연결</li>
                </ul>

                <h4>저장 데이터 암호화 (Encryption at Rest)</h4>
                <ul>
                    <li><strong>AWS KMS (Key Management Service)</strong>: 중앙 집중식 키 관리</li>
                    <li><strong>Customer Managed Keys (CMK)</strong>: 고객 관리형 키 사용</li>
                    <li><strong>자동 키 로테이션</strong>: 연 1회 자동 키 교체</li>
                    <li><strong>CloudHSM</strong>: FIPS 140-2 Level 3 준수가 필요한 경우</li>
                </ul>

                <h3>데이터 분류 및 보호 수준</h3>
                <table>
                    <thead>
                        <tr>
                            <th>분류</th>
                            <th>암호화</th>
                            <th>접근 제어</th>
                            <th>로깅</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Public</td>
                            <td>선택 사항</td>
                            <td>공개 읽기</td>
                            <td>기본</td>
                        </tr>
                        <tr>
                            <td>Internal</td>
                            <td>SSE (서버 측 암호화)</td>
                            <td>조직 내부만</td>
                            <td>기본</td>
                        </tr>
                        <tr>
                            <td>Confidential</td>
                            <td>CMK + 전송 중 암호화</td>
                            <td>승인된 팀만</td>
                            <td>상세 로깅</td>
                        </tr>
                        <tr>
                            <td>Restricted</td>
                            <td>CMK + VPC Endpoint</td>
                            <td>최소 권한 + MFA</td>
                            <td>실시간 모니터링</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <strong>중요:</strong> S3 버킷의 경우 기본 암호화를 활성화하고, 공개 액세스를 차단하는 것이 필수입니다.
                </div>

                <h3>S3 보안 구성 예시</h3>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyUnencryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-secure-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    },
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-secure-bucket",
        "arn:aws:s3:::my-secure-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}</div>
            </section>

            <!-- Section 5: IAM -->
            <section id="iam">
                <h2>5. 식별 및 접근 관리 (IAM)</h2>
                
                <h3>IAM 모범 사례</h3>
                
                <div class="success-box">
                    <strong>핵심 원칙:</strong>
                    <ul style="margin-top: 10px;">
                        <li>루트 계정 사용 금지 (MFA 활성화 후 잠금)</li>
                        <li>개별 사용자에게 고유 자격 증명 부여</li>
                        <li>그룹을 통한 권한 관리</li>
                        <li>최소 권한 원칙 적용</li>
                        <li>정기적인 권한 검토 및 감사</li>
                    </ul>
                </div>

                <h3>역할 기반 접근 제어 (RBAC) 정책 예시</h3>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowS3ReadWrite",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::my-app-bucket",
        "arn:aws:s3:::my-app-bucket/*"
      ],
      "Condition": {
        "StringEquals": {
          "aws:PrincipalOrgID": "o-xxxxxxxxx"
        },
        "IpAddress": {
          "aws:SourceIp": [
            "10.0.0.0/8",
            "172.16.0.0/12"
          ]
        }
      }
    },
    {
      "Sid": "DenyDeleteActions",
      "Effect": "Deny",
      "Action": [
        "s3:DeleteObject",
        "s3:DeleteBucket"
      ],
      "Resource": "*"
    }
  ]
}</div>

                <h3>IAM 권장 구성</h3>
                <ul>
                    <li><strong>MFA (Multi-Factor Authentication)</strong>: 모든 사용자 및 루트 계정에 필수 활성화</li>
                    <li><strong>IAM Access Analyzer</strong>: 외부와 공유되는 리소스 자동 탐지</li>
                    <li><strong>권한 경계 (Permission Boundaries)</strong>: 사용자 및 역할의 최대 권한 제한</li>
                    <li><strong>서비스 제어 정책 (SCP)</strong>: 조직 수준의 가드레일</li>
                    <li><strong>임시 자격 증명</strong>: 장기 액세스 키 대신 STS 사용</li>
                </ul>

                <h3>AWS IAM Identity Center (AWS SSO)</h3>
                <div class="info-box">
                    <strong>장점:</strong>
                    <ul style="margin-top: 10px;">
                        <li>중앙 집중식 사용자 접근 관리</li>
                        <li>SAML 2.0 기반 페더레이션 (Azure AD, Okta 등)</li>
                        <li>임시 자격 증명 자동 발급</li>
                        <li>다중 계정 접근을 위한 통합 포털</li>
                        <li>권한 세트를 통한 표준화된 권한 관리</li>
                    </ul>
                </div>

                <h3>IAM 정책 테스트 도구</h3>
                <ul>
                    <li><strong>IAM Policy Simulator</strong>: 정책 효과 사전 테스트</li>
                    <li><strong>Access Advisor</strong>: 마지막 사용 시간 기반 권한 정리</li>
                    <li><strong>CloudTrail</strong>: 실제 API 호출 기록 분석</li>
                </ul>
            </section>

            <!-- Section 6: 위협 탐지 및 대응 -->
            <section id="detection">
                <h2>6. 위협 탐지 및 대응</h2>
                
                <h3>보안 모니터링 스택</h3>
                
                <h4>Amazon GuardDuty</h4>
                <ul>
                    <li><strong>지능형 위협 탐지</strong>: 머신러닝 기반 이상 행위 탐지</li>
                    <li><strong>데이터 소스</strong>: VPC Flow Logs, CloudTrail, DNS 로그</li>
                    <li><strong>위협 인텔리전스</strong>: AWS 및 외부 위협 데이터베이스 활용</li>
                    <li><strong>주요 탐지 항목</strong>:
                        <ul>
                            <li>비정상적인 API 호출</li>
                            <li>암호화폐 채굴 활동</li>
                            <li>악성 IP 통신</li>
                            <li>무차별 대입 공격 (Brute Force)</li>
                        </ul>
                    </li>
                </ul>

                <h4>AWS Security Hub</h4>
                <ul>
                    <li><strong>통합 보안 대시보드</strong>: 모든 보안 도구의 결과 집계</li>
                    <li><strong>자동화된 컴플라이언스 점검</strong>: CIS, PCI-DSS, AWS FSBP</li>
                    <li><strong>보안 점수</strong>: 전체 보안 태세의 정량적 평가</li>
                    <li><strong>통합 서비스</strong>: GuardDuty, Inspector, Macie, IAM Access Analyzer 등</li>
                </ul>

                <h4>Amazon Detective</h4>
                <ul>
                    <li><strong>보안 사고 조사</strong>: 근본 원인 분석</li>
                    <li><strong>시각화된 그래프</strong>: 리소스 간 관계 및 활동 패턴</li>
                    <li><strong>기계 학습 분석</strong>: 정상 기준선 대비 이상 행위 식별</li>
                </ul>

                <h3>통합 SIEM 아키텍쳐</h3>
                <div class="architecture-diagram">┌──────────────┐
│ CloudTrail   │──┐
└──────────────┘  │
┌──────────────┐  │
│ GuardDuty    │──┤
└──────────────┘  │
┌──────────────┐  │     ┌────────────┐     ┌────────┐     ┌──────────────┐
│ Security Hub │──┼────→│ EventBridge│────→│ Lambda │────→│ SIEM/SOAR    │
└──────────────┘  │     └────────────┘     └────────┘     │ (Splunk/ELK) │
┌──────────────┐  │                                        └──────────────┘
│ AWS Config   │──┤
└──────────────┘  │
┌──────────────┐  │
│ Macie        │──┘
└──────────────┘</div>

                <h3>자동화된 보안 응답 워크플로우</h3>
                <div class="code-block"># EventBridge 규칙 예시 (Terraform)
resource "aws_cloudwatch_event_rule" "guardduty_findings" {
  name        = "guardduty-high-severity"
  description = "Trigger on high severity GuardDuty findings"

  event_pattern = jsonencode({
    source      = ["aws.guardduty"]
    detail-type = ["GuardDuty Finding"]
    detail = {
      severity = [7, 8, 9]  # High and Critical
    }
  })
}

resource "aws_cloudwatch_event_target" "lambda" {
  rule      = aws_cloudwatch_event_rule.guardduty_findings.name
  target_id = "SendToLambda"
  arn       = aws_lambda_function.security_response.arn
}</div>

                <div class="warning-box">
                    <strong>권장 사항:</strong> GuardDuty와 Security Hub는 모든 리전에서 활성화하고, 중앙 집중식 관리를 위해 delegated administrator를 설정하세요.
                </div>
            </section>

            <!-- Section 7: 애플리케이션 보안 -->
            <section id="application">
                <h2>7. 애플리케이션 보안</h2>
                
                <h3>AWS WAF (Web Application Firewall)</h3>
                
                <h4>핵심 WAF 규칙 세트</h4>
                <table>
                    <thead>
                        <tr>
                            <th>규칙 유형</th>
                            <th>설명</th>
                            <th>우선순위</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Rate Limiting</td>
                            <td>IP당 요청 수 제한 (DDoS 방어)</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>SQL Injection</td>
                            <td>SQL 인젝션 공격 패턴 차단</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>XSS (Cross-Site Scripting)</td>
                            <td>크로스 사이트 스크립팅 방어</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>Geo Blocking</td>
                            <td>특정 국가/지역 차단</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>Bot Control</td>
                            <td>악성 봇 탐지 및 관리</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>IP Reputation</td>
                            <td>알려진 악성 IP 차단</td>
                            <td>높음</td>
                        </tr>
                    </tbody>
                </table>

                <h4>AWS Managed Rules 활용</h4>
                <div class="code-block"># WAF v2 구성 예시 (Terraform)
resource "aws_wafv2_web_acl" "main" {
  name  = "web-acl-production"
  scope = "REGIONAL"

  default_action {
    allow {}
  }

  # Core Rule Set (CRS)
  rule {
    name     = "AWS-AWSManagedRulesCommonRuleSet"
    priority = 1

    override_action {
      none {}
    }

    statement {
      managed_rule_group_statement {
        vendor_name = "AWS"
        name        = "AWSManagedRulesCommonRuleSet"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                = "AWSManagedRulesCommonRuleSetMetric"
      sampled_requests_enabled   = true
    }
  }

  # Rate Limiting
  rule {
    name     = "RateLimitRule"
    priority = 2

    action {
      block {}
    }

    statement {
      rate_based_statement {
        limit              = 2000
        aggregate_key_type = "IP"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                = "RateLimitMetric"
      sampled_requests_enabled   = true
    }
  }
}</div>

                <h3>AWS Shield</h3>
                <ul>
                    <li><strong>Shield Standard</strong>: 모든 AWS 고객에게 자동 제공되는 L3/L4 DDoS 방어</li>
                    <li><strong>Shield Advanced</strong>:
                        <ul>
                            <li>고급 DDoS 방어 (L7 포함)</li>
                            <li>24/7 DDoS Response Team (DRT) 지원</li>
                            <li>비용 보호 (DDoS 공격 시 스케일링 비용 환불)</li>
                            <li>실시간 공격 알림 및 상세 리포트</li>
                        </ul>
                    </li>
                </ul>

                <h3>시크릿 관리 (Secrets Management)</h3>
                
                <h4>AWS Secrets Manager</h4>
                <ul>
                    <li>데이터베이스 자격 증명 자동 로테이션</li>
                    <li>API 키, OAuth 토큰 등 안전한 저장</li>
                    <li>세밀한 액세스 제어 (IAM 정책)</li>
                    <li>암호화 및 감사 로깅</li>
                </ul>

                <h4>Systems Manager Parameter Store</h4>
                <ul>
                    <li>계층적 파라미터 구조</li>
                    <li>무료 티어 제공 (표준 파라미터)</li>
                    <li>KMS 암호화 지원</li>
                    <li>버전 관리</li>
                </ul>

                <div class="warning-box">
                    <strong>절대 금지:</strong> 
                    <ul style="margin-top: 10px;">
                        <li>애플리케이션 코드에 자격 증명 하드코딩</li>
                        <li>환경 변수에 평문으로 저장</li>
                        <li>Git 저장소에 시크릿 커밋</li>
                        <li>장기 액세스 키 사용 (IAM Role 사용 권장)</li>
                    </ul>
                </div>

                <h3>애플리케이션 보안 모범 사례</h3>
                <div class="code-block"># Secrets Manager 사용 예시 (Python)
import boto3
import json

def get_secret():
    secret_name = "prod/database/credentials"
    region_name = "us-east-1"

    session = boto3.session.Session()
    client = session.client(
        service_name='secretsmanager',
        region_name=region_name
    )

    try:
        get_secret_value_response = client.get_secret_value(
            SecretId=secret_name
        )
    except ClientError as e:
        raise e

    secret = json.loads(get_secret_value_response['SecretString'])
    return secret

# 사용
db_credentials = get_secret()
username = db_credentials['username']
password = db_credentials['password']</div>
            </section>

            <!-- Section 8: 컴플라이언스 및 거버넌스 -->
            <section id="compliance">
                <h2>8. 컴플라이언스 및 거버넌스</h2>
                
                <h3>AWS Config</h3>
                
                <h4>핵심 Config 규칙</h4>
                <table>
                    <thead>
                        <tr>
                            <th>규칙</th>
                            <th>점검 내용</th>
                            <th>심각도</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>encrypted-volumes</td>
                            <td>EBS 볼륨 암호화 여부</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>s3-bucket-public-read-prohibited</td>
                            <td>S3 버킷 공개 읽기 차단</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>rds-storage-encrypted</td>
                            <td>RDS 인스턴스 암호화</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>iam-user-unused-credentials-check</td>
                            <td>미사용 IAM 자격 증명</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>restricted-ssh</td>
                            <td>SSH 포트(22) 전체 개방 여부</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>cloudtrail-enabled</td>
                            <td>CloudTrail 활성화 여부</td>
                            <td>높음</td>
                        </tr>
                    </tbody>
                </table>

                <h4>자동 준수 점검 및 교정</h4>
                <div class="architecture-diagram">AWS Config Rule 위반 감지
         ↓
Systems Manager Automation
         ↓
자동 교정 작업 실행
    (예: 공개 S3 버킷 비공개로 변경)
         ↓
SNS 알림 발송
         ↓
Security Hub에 결과 전송</div>

                <h3>감사 및 로깅</h3>
                
                <h4>AWS CloudTrail 구성</h4>
                <ul>
                    <li><strong>다중 리전 추적</strong>: 모든 리전의 이벤트 기록</li>
                    <li><strong>조직 추적</strong>: Organizations의 모든 계정 로그 중앙 집중</li>
                    <li><strong>로그 파일 무결성 검증</strong>: 로그 변조 탐지</li>
                    <li><strong>S3 버킷 보안</strong>:
                        <ul>
                            <li>버킷 암호화 (SSE-KMS)</li>
                            <li>MFA Delete 활성화</li>
                            <li>버킷 정책으로 삭제 방지</li>
                            <li>객체 잠금 (WORM)</li>
                        </ul>
                    </li>
                </ul>

                <h4>CloudTrail S3 버킷 정책 예시</h4>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AWSCloudTrailAclCheck",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudtrail.amazonaws.com"
      },
      "Action": "s3:GetBucketAcl",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket"
    },
    {
      "Sid": "AWSCloudTrailWrite",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudtrail.amazonaws.com"
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket/*",
      "Condition": {
        "StringEquals": {
          "s3:x-amz-acl": "bucket-owner-full-control"
        }
      }
    },
    {
      "Sid": "DenyUnencryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    },
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-cloudtrail-bucket",
        "arn:aws:s3:::my-cloudtrail-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}</div>

                <h3>컴플라이언스 프레임워크</h3>
                <ul>
                    <li><strong>CIS AWS Foundations Benchmark</strong>: 보안 모범 사례 체크리스트</li>
                    <li><strong>PCI-DSS</strong>: 카드 결제 데이터 보안 표준</li>
                    <li><strong>HIPAA</strong>: 의료 정보 보호 규정</li>
                    <li><strong>GDPR</strong>: EU 개인정보 보호 규정</li>
                    <li><strong>SOC 2</strong>: 서비스 조직 통제 보고서</li>
                </ul>

                <div class="info-box">
                    <strong>AWS Artifact:</strong> AWS의 컴플라이언스 보고서 및 계약을 다운로드할 수 있는 셀프 서비스 포털입니다. ISO 인증서, SOC 보고서 등을 확인할 수 있습니다.
                </div>
            </section>

            <!-- Section 9: 인시던트 대응 -->
            <section id="incident">
                <h2>9. 인시던트 대응 플레이북</h2>
                
                <h3>자동화된 인시던트 대응 워크플로우</h3>
                
                <h4>시나리오 1: 의심스러운 IAM 활동 탐지</h4>
                <div class="architecture-diagram">1. GuardDuty: UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration
         ↓
2. EventBridge 규칙 트리거
         ↓
3. Lambda 함수 실행
         ↓
4. 자동 대응 작업:
   ├─ IAM 사용자/역할 정책 격리 (권한 제거)
   ├─ 액세스 키 비활성화
   ├─ SNS/PagerDuty 알림
   ├─ JIRA 티켓 자동 생성
   └─ 관련 EC2 인스턴스 스냅샷 (포렌식)
         ↓
5. Security Hub에 조사 결과 기록
         ↓
6. Detective로 상세 분석</div>

                <h4>Lambda 자동 대응 함수 예시</h4>
                <div class="code-block">import boto3
import json

iam = boto3.client('iam')
sns = boto3.client('sns')

def lambda_handler(event, context):
    # GuardDuty 이벤트 파싱
    finding = event['detail']
    severity = finding['severity']
    finding_type = finding['type']
    
    # 높은 심각도만 처리
    if severity >= 7:
        # 영향받은 IAM 사용자 추출
        if 'resource' in finding:
            resource = finding['resource']
            if resource['resourceType'] == 'AccessKey':
                access_key_id = resource['accessKeyDetails']['accessKeyId']
                user_name = resource['accessKeyDetails']['userName']
                
                # 1. 액세스 키 비활성화
                try:
                    iam.update_access_key(
                        UserName=user_name,
                        AccessKeyId=access_key_id,
                        Status='Inactive'
                    )
                    print(f"Disabled access key: {access_key_id}")
                except Exception as e:
                    print(f"Error disabling key: {e}")
                
                # 2. 사용자 정책 격리
                isolation_policy = {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Deny",
                            "Action": "*",
                            "Resource": "*"
                        }
                    ]
                }
                
                try:
                    iam.put_user_policy(
                        UserName=user_name,
                        PolicyName='SecurityIncidentIsolation',
                        PolicyDocument=json.dumps(isolation_policy)
                    )
                    print(f"Isolated user: {user_name}")
                except Exception as e:
                    print(f"Error isolating user: {e}")
                
                # 3. SNS 알림
                message = f"""
                SECURITY ALERT - High Severity Finding
                
                Type: {finding_type}
                Severity: {severity}
                User: {user_name}
                Access Key: {access_key_id}
                
                Automated Actions Taken:
                - Access key disabled
                - User permissions isolated
                - Incident ticket created
                
                Please investigate immediately.
                """
                
                sns.publish(
                    TopicArn='arn:aws:sns:us-east-1:123456789012:SecurityAlerts',
                    Subject='URGENT: Security Incident Detected',
                    Message=message
                )
    
    return {
        'statusCode': 200,
        'body': json.dumps('Incident response completed')
    }</div>

                <h3>인시던트 대응 5단계 프로세스</h3>
                <table>
                    <thead>
                        <tr>
                            <th>단계</th>
                            <th>활동</th>
                            <th>도구</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. 탐지</td>
                            <td>보안 이벤트 식별 및 분류</td>
                            <td>GuardDuty, Security Hub, CloudWatch</td>
                        </tr>
                        <tr>
                            <td>2. 격리</td>
                            <td>영향받은 리소스 분리</td>
                            <td>Security Groups, IAM, Lambda</td>
                        </tr>
                        <tr>
                            <td>3. 조사</td>
                            <td>근본 원인 및 영향 범위 분석</td>
                            <td>Detective, CloudTrail, VPC Flow Logs</td>
                        </tr>
                        <tr>
                            <td>4. 복구</td>
                            <td>안전한 상태로 복원</td>
                            <td>AWS Backup, Snapshots, CloudFormation</td>
                        </tr>
                        <tr>
                            <td>5. 사후 검토</td>
                            <td>교훈 도출 및 프로세스 개선</td>
                            <td>문서화, 플레이북 업데이트</td>
                        </tr>
                    </tbody>
                </table>

                <h3>포렌식 준비</h3>
                <ul>
                    <li><strong>스냅샷 자동화</strong>: 의심 활동 감지 시 EBS 스냅샷 자동 생성</li>
                    <li><strong>로그 보존</strong>: CloudTrail 로그 최소 1년 이상 보관</li>
                    <li><strong>메모리 덤프</strong>: SSM Run Command를 통한 원격 메모리 수집</li>
                    <li><strong>네트워크 트래픽</strong>: VPC Traffic Mirroring 활용</li>
                </ul>

                <div class="warning-box">
                    <strong>중요:</strong> 인시던트 대응 플레이북은 정기적으로 테스트하고 업데이트해야 합니다. 최소 분기별 1회 모의 훈련을 권장합니다.
                </div>
            </section>

            <!-- Section 10: 서버리스 보안 -->
            <section id="serverless">
                <h2>10. 서버리스 보안</h2>
                
                <h3>AWS Lambda 보안 모범 사례</h3>
                
                <h4>1. 네트워크 격리</h4>
                <ul>
                    <li><strong>VPC 내 Lambda 실행</strong>: 민감한 리소스 접근 시</li>
                    <li><strong>Private Subnet 배치</strong>: NAT Gateway를 통한 인터넷 접근</li>
                    <li><strong>Security Group 최소화</strong>: 필요한 포트만 개방</li>
                    <li><strong>VPC Endpoints</strong>: AWS 서비스 접근 시 프라이빗 연결</li>
                </ul>

                <h4>2. 코드 보안</h4>
                <div class="code-block"># Lambda 함수 보안 구성 예시 (Python)
import os
import boto3
from aws_lambda_powertools import Logger, Tracer
from aws_lambda_powertools.utilities import parameters

logger = Logger()
tracer = Tracer()

# Secrets Manager에서 시크릿 가져오기
def get_database_credentials():
    secret_name = os.environ['DB_SECRET_NAME']
    return parameters.get_secret(secret_name)

@tracer.capture_lambda_handler
@logger.inject_lambda_context
def lambda_handler(event, context):
    # 입력 검증
    if 'user_id' not in event:
        logger.error("Missing required parameter: user_id")
        return {
            'statusCode': 400,
            'body': 'Bad Request'
        }
    
    user_id = event['user_id']
    
    # SQL 인젝션 방지: 파라미터화된 쿼리 사용
    # XSS 방지: 출력 인코딩
    # ...
    
    logger.info(f"Processing request for user: {user_id}")
    
    return {
        'statusCode': 200,
        'body': 'Success'
    }</div>

                <h4>3. IAM 권한 최소화</h4>
                <div class="code-block"># Lambda 실행 역할 (Terraform)
resource "aws_iam_role" "lambda_role" {
  name = "lambda-execution-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = "sts:AssumeRole"
        Effect = "Allow"
        Principal = {
          Service = "lambda.amazonaws.com"
        }
      }
    ]
  })
}

# 최소 권한 정책
resource "aws_iam_role_policy" "lambda_policy" {
  name = "lambda-policy"
  role = aws_iam_role.lambda_role.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ]
        Resource = "arn:aws:logs:*:*:*"
      },
      {
        Effect = "Allow"
        Action = [
          "dynamodb:GetItem",
          "dynamodb:PutItem"
        ]
        Resource = "arn:aws:dynamodb:us-east-1:123456789012:table/MyTable"
      }
    ]
  })
}</div>

                <h4>4. 환경 변수 암호화</h4>
                <ul>
                    <li>KMS를 사용한 환경 변수 암호화</li>
                    <li>Secrets Manager 또는 Parameter Store 사용 권장</li>
                    <li>런타임 시 복호화</li>
                </ul>

                <h3>API Gateway 보안</h3>
                
                <h4>인증 및 권한 부여 계층</h4>
                <div class="architecture-diagram">Client Request
      ↓
[1] AWS WAF (DDoS, SQL Injection 방어)
      ↓
[2] API Gateway
      ├─ Resource Policy (IP 제한, VPC 제한)
      ├─ Usage Plans & API Keys (Rate Limiting)
      └─ Authorizers
          ├─ Lambda Authorizer (커스텀 로직)
          └─ Cognito User Pools (OAuth 2.0)
      ↓
[3] Backend (Lambda, ECS, HTTP)
      ↓
Response</div>

                <h4>API Gateway 보안 설정</h4>
                <table>
                    <thead>
                        <tr>
                            <th>보안 기능</th>
                            <th>설명</th>
                            <th>사용 사례</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Lambda Authorizer</td>
                            <td>커스텀 인증 로직 실행</td>
                            <td>JWT 검증, 외부 IdP 통합</td>
                        </tr>
                        <tr>
                            <td>Cognito User Pools</td>
                            <td>완전 관리형 사용자 인증</td>
                            <td>표준 OAuth 2.0/OIDC</td>
                        </tr>
                        <tr>
                            <td>IAM Authentication</td>
                            <td>AWS 자격 증명 기반</td>
                            <td>내부 서비스 간 통신</td>
                        </tr>
                        <tr>
                            <td>API Keys</td>
                            <td>간단한 키 기반 접근</td>
                            <td>파트너 API, 사용량 추적</td>
                        </tr>
                        <tr>
                            <td>Resource Policies</td>
                            <td>리소스 기반 접근 제어</td>
                            <td>VPC/IP 화이트리스트</td>
                        </tr>
                    </tbody>
                </table>

                <h4>API Gateway Lambda Authorizer 예시</h4>
                <div class="code-block">import jwt
import os

def lambda_handler(event, context):
    token = event['authorizationToken']
    
    try:
        # JWT 토큰 검증
        decoded = jwt.decode(
            token,
            os.environ['JWT_SECRET'],
            algorithms=['HS256']
        )
        
        # 정책 생성
        policy = generate_policy(
            decoded['sub'],  # principalId
            'Allow',
            event['methodArn']
        )
        
        # 컨텍스트에 사용자 정보 추가
        policy['context'] = {
            'userId': decoded['sub'],
            'email': decoded['email'],
            'role': decoded['role']
        }
        
        return policy
    
    except jwt.ExpiredSignatureError:
        raise Exception('Unauthorized: Token expired')
    except jwt.InvalidTokenError:
        raise Exception('Unauthorized: Invalid token')

def generate_policy(principal_id, effect, resource):
    return {
        'principalId': principal_id,
        'policyDocument': {
            'Version': '2012-10-17',
            'Statement': [
                {
                    'Action': 'execute-api:Invoke',
                    'Effect': effect,
                    'Resource': resource
                }
            ]
        }
    }</div>

                <h3>서버리스 보안 체크리스트</h3>
                <ul class="checklist">
                    <li>Lambda 함수에 최소 권한 IAM 역할 할당</li>
                    <li>환경 변수 암호화 활성화</li>
                    <li>VPC 내 Lambda 배치 (필요시)</li>
                    <li>Dead Letter Queue (DLQ) 구성</li>
                    <li>Reserved Concurrency 설정 (DoS 방지)</li>
                    <li>X-Ray 추적 활성화</li>
                    <li>CloudWatch Logs 암호화</li>
                    <li>API Gateway에 WAF 연결</li>
                    <li>Rate Limiting 및 Throttling 설정</li>
                    <li>CORS 정책 엄격히 구성</li>
                </ul>
            </section>

            <!-- Section 11: 컨테이너 보안 -->
            <section id="container">
                <h2>11. 컨테이너 보안</h2>
                
                <h3>Amazon EKS 보안 아키텍쳐</h3>
                
                <h4>다층 보안 계층</h4>
                <div class="architecture-diagram">┌─────────────────────────────────────────┐
│  Pod Security Standards (PSS)           │
│  - Baseline, Restricted Policies        │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Network Policies (Calico/Cilium)       │
│  - Pod-to-Pod 트래픽 제어               │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  IRSA (IAM Roles for Service Accounts)  │
│  - Pod별 세밀한 권한 관리               │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Secrets Management                      │
│  - External Secrets Operator            │
│  - AWS Secrets Manager 통합             │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Image Scanning (ECR)                    │
│  - 빌드 시 취약점 스캔                  │
└─────────────────────────────────────────┘</div>

                <h3>주요 컨테이너 보안 도구</h3>
                
                <h4>1. Amazon ECR Image Scanning</h4>
                <ul>
                    <li><strong>Basic Scanning</strong>: Clair 기반 취약점 스캔</li>
                    <li><strong>Enhanced Scanning</strong>: Amazon Inspector 통합, 지속적 스캔</li>
                    <li><strong>스캔 정책</strong>: 푸시 시 자동 스캔 또는 스케줄 기반</li>
                    <li><strong>CVE 데이터베이스</strong>: 최신 취약점 정보 자동 업데이트</li>
                </ul>

                <div class="code-block"># ECR 리포지토리 생성 및 스캔 설정 (Terraform)
resource "aws_ecr_repository" "app" {
  name                 = "my-application"
  image_tag_mutability = "IMMUTABLE"

  image_scanning_configuration {
    scan_on_push = true
  }

  encryption_configuration {
    encryption_type = "KMS"
    kms_key        = aws_kms_key.ecr.arn
  }
}

# 라이프사이클 정책 (오래된 이미지 자동 삭제)
resource "aws_ecr_lifecycle_policy" "app" {
  repository = aws_ecr_repository.app.name

  policy = jsonencode({
    rules = [
      {
        rulePriority = 1
        description  = "Keep last 10 images"
        selection = {
          tagStatus   = "any"
          countType   = "imageCountMoreThan"
          countNumber = 10
        }
        action = {
          type = "expire"
        }
      }
    ]
  })
}</div>

                <h4>2. Falco - 런타임 보안 모니터링</h4>
                <ul>
                    <li>실시간 시스템 콜 모니터링</li>
                    <li>비정상 행위 탐지 (파일 접근, 프로세스 실행 등)</li>
                    <li>사전 정의된 보안 규칙</li>
                    <li>Kubernetes 이벤트 통합</li>
                </ul>

                <div class="code-block"># Falco 규칙 예시
- rule: Unauthorized Process in Container
  desc: Detect unexpected process in container
  condition: >
    spawned_process and 
    container and 
    not proc.name in (allowed_processes)
  output: >
    Unauthorized process started in container 
    (user=%user.name command=%proc.cmdline container=%container.name 
    image=%container.image.repository)
  priority: WARNING

- rule: Write below root
  desc: Attempt to write to root filesystem
  condition: >
    open_write and 
    container and 
    fd.name startswith /
  output: >
    Write attempt to root filesystem 
    (user=%user.name command=%proc.cmdline file=%fd.name)
  priority: ERROR</div>

                <h4>3. OPA/Gatekeeper - 정책 기반 거버넌스</h4>
                <ul>
                    <li>Admission Controller를 통한 정책 강제</li>
                    <li>선언적 정책 정의 (Rego 언어)</li>
                    <li>리소스 생성 시 자동 검증</li>
                </ul>

                <div class="code-block"># Gatekeeper Constraint Template 예시
apiVersion: templates.gatekeeper.sh/v1
kind: ConstraintTemplate
metadata:
  name: k8srequiredlabels
spec:
  crd:
    spec:
      names:
        kind: K8sRequiredLabels
      validation:
        openAPIV3Schema:
          type: object
          properties:
            labels:
              type: array
              items:
                type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package k8srequiredlabels
        
        violation[{"msg": msg, "details": {"missing_labels": missing}}] {
          provided := {label | input.review.object.metadata.labels[label]}
          required := {label | label := input.parameters.labels[_]}
          missing := required - provided
          count(missing) > 0
          msg := sprintf("You must provide labels: %v", [missing])
        }

---
# Constraint 적용
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sRequiredLabels
metadata:
  name: pod-must-have-labels
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
  parameters:
    labels:
      - "app"
      - "environment"
      - "owner"</div>

                <h3>IRSA (IAM Roles for Service Accounts)</h3>
                <div class="code-block"># ServiceAccount 생성
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-sa
  namespace: production
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/my-app-role

---
# Pod에서 ServiceAccount 사용
apiVersion: v1
kind: Pod
metadata:
  name: my-app
  namespace: production
spec:
  serviceAccountName: my-app-sa
  containers:
  - name: app
    image: my-app:latest
    # 이제 Pod는 IAM 역할의 권한을 자동으로 사용
    # AWS SDK가 자동으로 임시 자격 증명 획득</div>

                <h3>컨테이너 보안 모범 사례</h3>
                <ul class="checklist">
                    <li>최소 권한 원칙으로 컨테이너 실행 (non-root 사용자)</li>
                    <li>읽기 전용 루트 파일시스템 사용</li>
                    <li>불필요한 Linux Capabilities 제거</li>
                    <li>리소스 제한 (CPU, Memory) 설정</li>
                    <li>프라이빗 ECR 리포지토리 사용</li>
                    <li>이미지 서명 및 검증 (Notary/Cosign)</li>
                    <li>Network Policies로 Pod 간 트래픽 제한</li>
                    <li>Pod Security Standards 적용</li>
                    <li>정기적인 이미지 업데이트 및 재배포</li>
                    <li>Secrets을 환경 변수 대신 파일로 마운트</li>
                </ul>

                <h3>보안 강화된 Pod 명세 예시</h3>
                <div class="code-block">apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
  labels:
    app: secure-app
spec:
  serviceAccountName: my-app-sa
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
    seccompProfile:
      type: RuntimeDefault
  
  containers:
  - name: app
    image: 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:v1.2.3
    
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    
    volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: secrets
      mountPath: /etc/secrets
      readOnly: true
  
  volumes:
  - name: tmp
    emptyDir: {}
  - name: secrets
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "aws-secrets"</div>
            </section>

            <!-- Section 12: 자동화 및 IaC -->
            <section id="automation">
                <h2>12. 자동화 및 Infrastructure as Code</h2>
                
                <h3>보안 자동화의 중요성</h3>
                <div class="info-box">
                    <strong>DevSecOps 원칙:</strong> 보안을 개발 파이프라인의 모든 단계에 통합하여 "Shift Left" 접근 방식을 구현합니다.
                </div>

                <h3>Terraform 보안 베이스라인 모듈</h3>
                <div class="code-block"># modules/security-baseline/main.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# GuardDuty 활성화
resource "aws_guardduty_detector" "main" {
  enable                       = var.enable_guardduty
  finding_publishing_frequency = "FIFTEEN_MINUTES"
  
  datasources {
    s3_logs {
      enable = true
    }
    kubernetes {
      audit_logs {
        enable = true
      }
    }
    malware_protection {
      scan_ec2_instance_with_findings {
        ebs_volumes {
          enable = true
        }
      }
    }
  }

  tags = var.tags
}

# Security Hub 활성화
resource "aws_securityhub_account" "main" {
  count = var.enable_security_hub ? 1 : 0
}

resource "aws_securityhub_standards_subscription" "cis" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
}

resource "aws_securityhub_standards_subscription" "aws_foundational" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:${data.aws_region.current.name}::standards/aws-foundational-security-best-practices/v/1.0.0"
}

# AWS Config 활성화
resource "aws_config_configuration_recorder" "main" {
  name     = "security-config-recorder"
  role_arn = aws_iam_role.config.arn

  recording_group {
    all_supported = true
    include_global_resources = true
  }
}

resource "aws_config_delivery_channel" "main" {
  name           = "security-config-delivery"
  s3_bucket_name = aws_s3_bucket.config.bucket
  depends_on     = [aws_config_configuration_recorder.main]
}

resource "aws_config_configuration_recorder_status" "main" {
  name       = aws_config_configuration_recorder.main.name
  is_enabled = true
  depends_on = [aws_config_delivery_channel.main]
}

# CloudTrail 멀티 리전 추적
resource "aws_cloudtrail" "main" {
  name                          = var.cloudtrail_name
  s3_bucket_name                = aws_s3_bucket.cloudtrail.bucket
  include_global_service_events = true
  is_multi_region_trail         = true
  enable_log_file_validation    = true
  
  event_selector {
    read_write_type           = "All"
    include_management_events = true

    data_resource {
      type   = "AWS::S3::Object"
      values = ["arn:aws:s3:::"]
    }

    data_resource {
      type   = "AWS::Lambda::Function"
      values = ["arn:aws:lambda"]
    }
  }

  insight_selector {
    insight_type = "ApiCallRateInsight"
  }

  cloud_watch_logs_group_arn = "${aws_cloudwatch_log_group.cloudtrail.arn}:*"
  cloud_watch_logs_role_arn  = aws_iam_role.cloudtrail_cloudwatch.arn
  kms_key_id                 = aws_kms_key.cloudtrail.arn

  tags = var.tags
}

# S3 버킷 암호화 및 보안 설정
resource "aws_s3_bucket" "cloudtrail" {
  bucket = var.cloudtrail_bucket_name

  tags = var.tags
}

resource "aws_s3_bucket_versioning" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm     = "aws:kms"
      kms_master_key_id = aws_kms_key.cloudtrail.arn
    }
  }
}

resource "aws_s3_bucket_public_access_block" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

# 로그 보존 정책
resource "aws_cloudwatch_log_group" "cloudtrail" {
  name              = "/aws/cloudtrail/${var.cloudtrail_name}"
  retention_in_days = var.log_retention_days
  kms_key_id        = aws_kms_key.cloudwatch.arn

  tags = var.tags
}

# variables.tf
variable "enable_guardduty" {
  description = "Enable GuardDuty"
  type        = bool
  default     = true
}

variable "enable_security_hub" {
  description = "Enable Security Hub"
  type        = bool
  default     = true
}

variable "enable_config" {
  description = "Enable AWS Config"
  type        = bool
  default     = true
}

variable "cloudtrail_name" {
  description = "CloudTrail name"
  type        = string
  default     = "organization-trail"
}

variable "cloudtrail_bucket_name" {
  description = "S3 bucket for CloudTrail logs"
  type        = string
}

variable "log_retention_days" {
  description = "CloudWatch Logs retention in days"
  type        = number
  default     = 365
}

variable "tags" {
  description = "Tags to apply to resources"
  type        = map(string)
  default     = {}
}</div>

                <h3>사용 예시</h3>
                <div class="code-block"># main.tf
module "security_baseline" {
  source = "./modules/security-baseline"
  
  enable_guardduty    = true
  enable_security_hub = true
  enable_config       = true
  
  cloudtrail_name        = "production-audit-trail"
  cloudtrail_bucket_name = "my-org-cloudtrail-logs-123456789012"
  log_retention_days     = 365
  
  tags = {
    Environment = "Production"
    ManagedBy   = "Terraform"
    Compliance  = "PCI-DSS"
    CostCenter  = "Security"
  }
}</div>

                <h3>DevSecOps 파이프라인</h3>
                <div class="architecture-diagram">┌─────────────┐
│   Code      │  Git Commit
└─────────────┘
      ↓
┌─────────────┐
│   SAST      │  SonarQube, Semgrep
└─────────────┘  코드 정적 분석
      ↓
┌─────────────┐
│   Build     │  Docker Build
└─────────────┘
      ↓
┌─────────────┐
│   Scan      │  Trivy, Snyk, Grype
└─────────────┘  컨테이너 이미지 스캔
      ↓
┌─────────────┐
│   IaC Scan  │  Checkov, tfsec
└─────────────┘  인프라 코드 검증
      ↓
┌─────────────┐
│   Deploy    │  ArgoCD, Flux
└─────────────┘
      ↓
┌─────────────┐
│   DAST      │  OWASP ZAP
└─────────────┘  동적 애플리케이션 스캔
      ↓
┌─────────────┐
│   Monitor   │  GuardDuty, Falco
└─────────────┘  런타임 보안 모니터링</div>

                <h3>GitHub Actions 보안 파이프라인 예시</h3>
                <div class="code-block">name: Security Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    
    steps:
    # 코드 체크아웃
    - name: Checkout code
      uses: actions/checkout@v3

    # SAST - 정적 코드 분석
    - name: Run Semgrep
      uses: returntocorp/semgrep-action@v1
      with:
        config: >-
          p/security-audit
          p/secrets
          p/owasp-top-ten

    # Secrets 스캔
    - name: GitGuardian scan
      uses: GitGuardian/ggshield-action@v1
      env:
        GITHUB_PUSH_BEFORE_SHA: ${{ github.event.before }}
        GITHUB_PUSH_BASE_SHA: ${{ github.event.base }}
        GITHUB_DEFAULT_BRANCH: ${{ github.event.repository.default_branch }}
        GITGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN_API_KEY }}

    # 의존성 취약점 스캔
    - name: Run Snyk
      uses: snyk/actions/node@master
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      with:
        args: --severity-threshold=high

    # Docker 이미지 빌드
    - name: Build Docker image
      run: |
        docker build -t myapp:${{ github.sha }} .

    # 컨테이너 이미지 스캔
    - name: Run Trivy scanner
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'myapp:${{ github.sha }}'
        format: 'sarif'
        output: 'trivy-results.sarif'
        severity: 'CRITICAL,HIGH'

    # SARIF 결과를 GitHub Security에 업로드
    - name: Upload Trivy results to GitHub Security
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'

    # Terraform 보안 스캔
    - name: Run tfsec
      uses: aquasecurity/tfsec-action@v1.0.0
      with:
        soft_fail: false

    # Checkov - IaC 보안 스캔
    - name: Run Checkov
      uses: bridgecrewio/checkov-action@master
      with:
        directory: ./terraform
        framework: terraform
        output_format: sarif
        output_file_path: checkov-results.sarif

    # 모든 검사 통과 시 ECR에 푸시
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
        aws-region: us-east-1

    - name: Login to Amazon ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Push to ECR
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        ECR_REPOSITORY: myapp
        IMAGE_TAG: ${{ github.sha }}
      run: |
        docker tag myapp:$IMAGE_TAG $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG</div>

                <h3>정책 as Code (Policy as Code)</h3>
                <div class="code-block"># OPA Rego 정책 예시
# terraform_s3_encryption.rego

package terraform.s3

# S3 버킷은 반드시 암호화되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not resource.server_side_encryption_configuration
  msg := sprintf("S3 bucket '%s' must have encryption enabled", [name])
}

# 공개 액세스는 반드시 차단되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not input.resource.aws_s3_bucket_public_access_block[name]
  msg := sprintf("S3 bucket '%s' must have public access blocked", [name])
}

# 버전 관리는 반드시 활성화되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not input.resource.aws_s3_bucket_versioning[name]
  msg := sprintf("S3 bucket '%s' must have versioning enabled", [name])
}</div>

                <h3>자동화 도구 비교</h3>
                <table>
                    <thead>
                        <tr>
                            <th>도구</th>
                            <th>용도</th>
                            <th>장점</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Terraform</td>
                            <td>IaC 프로비저닝</td>
                            <td>멀티 클라우드, 풍부한 생태계</td>
                        </tr>
                        <tr>
                            <td>CloudFormation</td>
                            <td>AWS 네이티브 IaC</td>
                            <td>AWS 서비스 빠른 지원</td>
                        </tr>
                        <tr>
                            <td>Checkov</td>
                            <td>IaC 보안 스캔</td>
                            <td>1000+ 내장 정책</td>
                        </tr>
                        <tr>
                            <td>tfsec</td>
                            <td>Terraform 보안</td>
                            <td>빠른 속도, CI/CD 통합</td>
                        </tr>
                        <tr>
                            <td>Trivy</td>
                            <td>이미지/IaC 스캔</td>
                            <td>올인원, 오픈소스</td>
                        </tr>
                        <tr>
                            <td>SonarQube</td>
                            <td>코드 품질/보안</td>
                            <td>상세한 분석, 대시보드</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Section 13: 지속적인 보안 개선 -->
            <section>
                <h2>13. 지속적인 보안 개선</h2>
                
                <h3>보안 성숙도 모델</h3>
                <table>
                    <thead>
                        <tr>
                            <th>레벨</th>
                            <th>설명</th>
                            <th>핵심 활동</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. 기본</td>
                            <td>최소한의 보안 통제</td>
                            <td>IAM, 암호화, CloudTrail</td>
                        </tr>
                        <tr>
                            <td>2. 관리</td>
                            <td>조직화된 보안 프로세스</td>
                            <td>GuardDuty, Config, 정책 문서화</td>
                        </tr>
                        <tr>
                            <td>3. 정의</td>
                            <td>표준화된 보안 절차</td>
                            <td>자동화, IaC, 정기 감사</td>
                        </tr>
                        <tr>
                            <td>4. 최적화</td>
                            <td>지속적 개선</td>
                            <td>머신러닝, 예측 분석</td>
                        </tr>
                        <tr>
                            <td>5. 혁신</td>
                            <td>업계 리더</td>
                            <td>Zero Trust, 자율 보안</td>
                        </tr>
                    </tbody>
                </table>

                <h3>정기 점검 체크리스트</h3>
                
                <h4>월간 점검</h4>
                <ul class="checklist">
                    <li>IAM 사용자 및 권한 검토</li>
                    <li>미사용 액세스 키 식별 및 제거</li>
                    <li>Security Hub 점수 확인</li>
                    <li>GuardDuty 발견사항 검토</li>
                    <li>비용 이상치 분석 (암호화폐 채굴 탐지)</li>
                </ul>

                <h4>분기별 점검</h4>
                <ul class="checklist">
                    <li>전체 Security Group 감사</li>
                    <li>Network ACL 규칙 검토</li>
                    <li>S3 버킷 공개 액세스 스캔</li>
                    <li>암호화 키 로테이션 확인</li>
                    <li>재해 복구 훈련 (Disaster Recovery Drill)</li>
                    <li>백업 복원 테스트</li>
                </ul>

                <h4>반기별 점검</h4>
                <ul class="checklist">
                    <li>침투 테스트 (Penetration Testing)</li>
                    <li>취약점 평가 (Vulnerability Assessment)</li>
                    <li>보안 정책 문서 업데이트</li>
                    <li>직원 보안 교육</li>
                    <li>사고 대응 플레이북 시뮬레이션</li>
                </ul>

                <h4>연간 점검</h4>
                <ul class="checklist">
                    <li>전체 아키텍쳐 보안 리뷰</li>
                    <li>외부 보안 감사</li>
                    <li>컴플라이언스 인증 갱신</li>
                    <li>보안 로드맵 수립</li>
                    <li>기술 부채 평가 및 개선 계획</li>
                </ul>

                <h3>보안 메트릭 (KPI)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>지표</th>
                            <th>측정 방법</th>
                            <th>목표</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>평균 탐지 시간 (MTTD)</td>
                            <td>위협 발생부터 탐지까지</td>
                            <td>&lt; 5분</td>
                        </tr>
                        <tr>
                            <td>평균 대응 시간 (MTTR)</td>
                            <td>탐지부터 완화까지</td>
                            <td>&lt; 15분</td>
                        </tr>
                        <tr>
                            <td>패치 적용 시간</td>
                            <td>CVE 공개부터 패치까지</td>
                            <td>&lt; 30일</td>
                        </tr>
                        <tr>
                            <td>미해결 보안 발견사항</td>
                            <td>Security Hub 미해결 건수</td>
                            <td>0 (Critical/High)</td>
                        </tr>
                        <tr>
                            <td>보안 교육 이수율</td>
                            <td>직원 교육 완료 비율</td>
                            <td>100%</td>
                        </tr>
                    </tbody>
                </table>

                <h3>보안 문화 구축</h3>
                <div class="success-box">
                    <strong>보안은 모든 사람의 책임입니다</strong>
                    <ul style="margin-top: 10px;">
                        <li><strong>교육</strong>: 정기적인 보안 인식 교육 실시</li>
                        <li><strong>공유</strong>: 보안 인시던트 학습 내용 전사 공유</li>
                        <li><strong>보상</strong>: 보안 취약점 발견 시 인센티브 제공</li>
                        <li><strong>투명성</strong>: 보안 메트릭을 공개하여 개선 동기 부여</li>
                        <li><strong>지원</strong>: 보안 챔피언 프로그램 운영</li>
                    </ul>
                </div>
            </section>

            <!-- Section 14: 참고 리소스 -->
            <section>
                <h2>14. 참고 리소스 및 문서</h2>
                
                <h3>AWS 공식 문서</h3>
                <ul>
                    <li><a href="https://aws.amazon.com/architecture/well-architected/" target="_blank">AWS Well-Architected Framework - Security Pillar</a></li>
                    <li><a href="https://docs.aws.amazon.com/security/" target="_blank">AWS Security Documentation</a></li>
                    <li><a href="https://aws.amazon.com/security/security-resources/" target="_blank">AWS Security Resources</a></li>
                    <li><a href="https://aws.amazon.com/compliance/" target="_blank">AWS Compliance Programs</a></li>
                </ul>

                <h3>보안 표준 및 프레임워크</h3>
                <ul>
                    <li><a href="https://www.cisecurity.org/benchmark/amazon_web_services" target="_blank">CIS AWS Foundations Benchmark</a></li>
                    <li><a href="https://www.nist.gov/cyberframework" target="_blank">NIST Cybersecurity Framework</a></li>
                    <li><a href="https://owasp.org/www-project-top-ten/" target="_blank">OWASP Top 10</a></li>
                    <li><a href="https://www.sans.org/cloud-security/" target="_blank">SANS Cloud Security</a></li>
                </ul>

                <h3>오픈소스 보안 도구</h3>
                <ul>
                    <li><a href="https://github.com/prowler-cloud/prowler" target="_blank">Prowler - AWS 보안 평가 도구</a></li>
                    <li><a href="https://github.com/bridgecrewio/checkov" target="_blank">Checkov - IaC 보안 스캐너</a></li>
                    <li><a href="https://github.com/aquasecurity/trivy" target="_blank">Trivy - 취약점 스캐너</a></li>
                    <li><a href="https://github.com/falcosecurity/falco" target="_blank">Falco - 런타임 보안</a></li>
                    <li><a href="https://github.com/tfsec/tfsec" target="_blank">tfsec - Terraform 보안</a></li>
                </ul>

                <h3>보안 블로그 및 뉴스</h3>
                <ul>
                    <li><a href="https://aws.amazon.com/blogs/security/" target="_blank">AWS Security Blog</a></li>
                    <li><a href="https://www.schneier.com/" target="_blank">Schneier on Security</a></li>
                    <li><a href="https://krebsonsecurity.com/" target="_blank">Krebs on Security</a></li>
                    <li><a href="https://threatpost.com/" target="_blank">Threatpost</a></li>
                </ul>

                <h3>AWS 보안 서비스 요약</h3>
                <table>
                    <thead>
                        <tr>
                            <th>서비스</th>
                            <th>카테고리</th>
                            <th>주요 기능</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>IAM</td>
                            <td>접근 관리</td>
                            <td>사용자 및 권한 관리</td>
                        </tr>
                        <tr>
                            <td>GuardDuty</td>
                            <td>위협 탐지</td>
                            <td>지능형 위협 탐지</td>
                        </tr>
                        <tr>
                            <td>Security Hub</td>
                            <td>보안 통합</td>
                            <td>통합 보안 대시보드</td>
                        </tr>
                        <tr>
                            <td>Inspector</td>
                            <td>취약점 평가</td>
                            <td>자동화된 보안 평가</td>
                        </tr>
                        <tr>
                            <td>Macie</td>
                            <td>데이터 보호</td>
                            <td>민감 데이터 검색</td>
                        </tr>
                        <tr>
                            <td>WAF</td>
                            <td>애플리케이션 보호</td>
                            <td>웹 애플리케이션 방화벽</td>
                        </tr>
                        <tr>
                            <td>Shield</td>
                            <td>DDoS 방어</td>
                            <td>DDoS 공격 방어</td>
                        </tr>
                        <tr>
                            <td>KMS</td>
                            <td>암호화</td>
                            <td>키 관리 서비스</td>
                        </tr>
                        <tr>
                            <td>Secrets Manager</td>
                            <td>시크릿 관리</td>
                            <td>자격 증명 안전 저장</td>
                        </tr>
                        <tr>
                            <td>CloudTrail</td>
                            <td>감사</td>
                            <td>API 호출 기록</td>
                        </tr>
                        <tr>
                            <td>Config</td>
                            <td>규정 준수</td>
                            <td>리소스 구성 추적</td>
                        </tr>
                        <tr>
                            <td>Detective</td>
                            <td>조사</td>
                            <td>보안 사고 분석</td>
                        </tr>
                    </tbody>
                </table>
            </section>

        </main>

        <footer>
            <p>&copy; 2024 AWS Security Architecture Guide</p>
            <p>이 문서는 교육 목적으로 작성되었습니다. 실제 환경에 적용 시 조직의 요구사항에 맞게 조정하세요.</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                <strong>연락처:</strong> security@example.com | 
                <strong>버전:</strong> 1.0 | 
                <strong>최종 업데이트:</strong> 2024
            </p>
        </footer>
    </div>

    <a href="#" class="back-to-top">↑</a>

    <script>
        // 부드러운 스크롤
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Back to top 버튼 표시/숨김
        const backToTopButton = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.style.display = 'flex';
            } else {
                backToTopButton.style.display = 'none';
            }
        });

        // 초기 상태
        backToTopButton.style.display = 'none';
    </script>
</body>
</html>
```

HTML 파일을 생성했습니다! 주요 특징은:

## 📋 주요 기능

1. **반응형 디자인**: 모바일, 태블릿, 데스크톱 모두 지원
2. **네비게이션**: 상단 고정 메뉴로 빠른 섹션 이동
3. **시각적 요소**:
   - AWS 브랜드 컬러 활용 (#232F3E, #FF9900)
   - 코드 블록 하이라이팅
   - 아키텍쳐 다이어그램
   - 정보/경고/성공 박스
4. **인터랙티브 요소**:
   - 부드러운 스크롤
   - Back to top 버튼
   - 호버 효과
5. **인쇄 친화적**: 문서 출력 가능

## 💾 사용 방법

1. 위 코드를 `aws-security-guide.html` 파일로 저장
2. 브라우저에서 파일 열기
3. 필요시 PDF로 저장 가능 (Ctrl+P)

혹시 추가로 수정하고 싶은 부분이 있으시면 말씀해주세요!
User:  <div class="code-block"># modules/security-baseline/main.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# GuardDuty 활성화
resource "aws_guardduty_detector" "main" {
  enable                       = var.enable_guardduty
  finding_publishing_frequency = "FIFTEEN_MINUTES"
  
  datasources {
    s3_logs {
      enable = true
    }
    kubernetes {
      audit_logs {
        enable = true
      }
    }
    malware_protection {
      scan_ec2_instance_with_findings {
        ebs_volumes {
          enable = true
        }
      }
    }
  }

  tags = var.tags
}

# Security Hub 활성화
resource "aws_securityhub_account" "main" {
  count = var.enable_security_hub ? 1 : 0
}

resource "aws_securityhub_standards_subscription" "cis" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
}

resource "aws_securityhub_standards_subscription" "aws_foundational" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:\${data.aws_region.current.name}::standards/aws-foundational-security-best-practices/v/1.0.0"
}

# AWS Config 활성화
resource "aws_config_configuration_recorder" "main" {
  name     = "security-config-recorder"
  role_arn = aws_iam_role.config.arn

  recording_group {
    all_supported = true
    include_global_resources = true
  }
}

resource "aws_config_delivery_channel" "main" {
  name           = "security-config-delivery"
  s3_bucket_name = aws_s3_bucket.config.bucket
  depends_on     = [aws_config_configuration_recorder.main]
}

resource "aws_config_configuration_recorder_status" "main" {
  name       = aws_config_configuration_recorder.main.name
  is_enabled = true
  depends_on = [aws_config_delivery_channel.main]
}

# CloudTrail 멀티 리전 추적
resource "aws_cloudtrail" "main" {
  name                          = var.cloudtrail_name
  s3_bucket_name                = aws_s3_bucket.cloudtrail.bucket
  include_global_service_events = true
  is_multi_region_trail         = true
  enable_log_file_validation    = true
  
  event_selector {
    read_write_type           = "All"
    include_management_events = true

    data_resource {
      type   = "AWS::S3::Object"
      values = ["arn:aws:s3:::"]
    }

    data_resource {
      type   = "AWS::Lambda::Function"
      values = ["arn:aws:lambda"]
    }
  }

  insight_selector {
    insight_type = "ApiCallRateInsight"
  }

  cloud_watch_logs_group_arn = "\${aws_cloudwatch_log_group.cloudtrail.arn}:*"
  cloud_watch_logs_role_arn  = aws_iam_role.cloudtrail_cloudwatch.arn
  kms_key_id                 = aws_kms_key.cloudtrail.arn

  tags = var.tags
}

# S3 버킷 암호화 및 보안 설정
resource "aws_s3_bucket" "cloudtrail" {
  bucket = var.cloudtrail_bucket_name

  tags = var.tags
}

resource "aws_s3_bucket_versioning" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm     = "aws:kms"
      kms_master_key_id = aws_kms_key.cloudtrail.arn
    }
  }
}

resource "aws_s3_bucket_public_access_block" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

# 로그 보존 정책
resource "aws_cloudwatch_log_group" "cloudtrail" {
  name              = "/aws/cloudtrail/\${var.cloudtrail_name}"
  retention_in_days = var.log_retention_days
  kms_key_id        = aws_kms_key.cloudwatch.arn

  tags = var.tags
}

# variables.tf
variable "enable_guardduty" {
  description = "Enable GuardDuty"
  type        = bool
  default     = true
}

variable "enable_security_hub" {
  description = "Enable Security Hub"
  type        = bool
  default     = true
}

variable "enable_config" {
  description = "Enable AWS Config"
  type        = bool
  default     = true
}

variable "cloudtrail_name" {
  description = "CloudTrail name"
  type        = string
  default     = "organization-trail"
}

variable "cloudtrail_bucket_name" {
  description = "S3 bucket for CloudTrail logs"
  type        = string
}

variable "log_retention_days" {
  description = "CloudWatch Logs retention in days"
  type        = number
  default     = 365
}

variable "tags" {
  description = "Tags to apply to resources"
  type        = map(string)
  default     = {}
}</div>

                <h3>사용 예시</h3>
                <div class="code-block"># main.tf
module "security_baseline" {
  source = "./modules/security-baseline"
  
  enable_guardduty    = true
  enable_security_hub = true
  enable_config       = true
  
  cloudtrail_name        = "production-audit-trail"
  cloudtrail_bucket_name = "my-org-cloudtrail-logs-123456789012"
  log_retention_days     = 365
  
  tags = {
    Environment = "Production"
    ManagedBy   = "Terraform"
    Compliance  = "PCI-DSS"
    CostCenter  = "Security"
  }
}</div>

이런 부분이 네모박스에 나오는데 한줄로 나와서 가독성이 좋지 않아. 수정해
Model: 코드 블록의 가독성을 개선하겠습니다. CSS를 수정하여 줄바꿈과 스크롤을 개선하겠습니다.

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS 차세대 보안 아키텍쳐 설계 가이드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #232F3E 0%, #FF9900 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 3px solid #FF9900;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        nav a {
            color: #232F3E;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: #FF9900;
            color: white;
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
            scroll-margin-top: 80px;
        }

        h2 {
            color: #232F3E;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #FF9900;
        }

        h3 {
            color: #FF9900;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #232F3E;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        /* 개선된 코드 블록 스타일 */
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #FF9900;
        }

        /* 코드 블록 내 스크롤바 스타일 */
        .code-block::-webkit-scrollbar {
            height: 10px;
        }

        .code-block::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 5px;
        }

        .code-block::-webkit-scrollbar-thumb {
            background: #FF9900;
            border-radius: 5px;
        }

        .code-block::-webkit-scrollbar-thumb:hover {
            background: #cc7a00;
        }

        /* 코드 구문 강조 */
        .code-block .comment {
            color: #6a9955;
        }

        .code-block .keyword {
            color: #569cd6;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .number {
            color: #b5cea8;
        }

        .architecture-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #FF9900;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.5;
            font-size: 14px;
            border-radius: 5px;
        }

        .architecture-diagram::-webkit-scrollbar {
            height: 8px;
        }

        .architecture-diagram::-webkit-scrollbar-track {
            background: #e9ecef;
            border-radius: 4px;
        }

        .architecture-diagram::-webkit-scrollbar-thumb {
            background: #FF9900;
            border-radius: 4px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ff9900;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-x: auto;
            display: block;
        }

        @media screen and (min-width: 768px) {
            table {
                display: table;
            }
        }

        thead {
            display: table-header-group;
        }

        tbody {
            display: table-row-group;
        }

        th {
            background: #232F3E;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li:before {
            content: "☐ ";
            color: #FF9900;
            font-weight: bold;
            margin-right: 10px;
        }

        footer {
            background: #232F3E;
            color: white;
            text-align: center;
            padding: 30px;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #FF9900;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .back-to-top:hover {
            background: #232F3E;
            transform: translateY(-5px);
        }

        /* 반응형 디자인 개선 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header h1 {
                font-size: 1.8em;
            }

            main {
                padding: 20px;
            }

            nav ul {
                flex-direction: column;
                align-items: stretch;
            }

            nav a {
                display: block;
                text-align: center;
            }

            .code-block {
                font-size: 12px;
                padding: 15px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }
        }

        /* 인쇄 스타일 */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
            }

            nav, .back-to-top {
                display: none;
            }

            .code-block {
                background: #f5f5f5;
                color: black;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }

            section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🛡️ AWS 차세대 보안 아키텍쳐 설계 가이드</h1>
            <p>클라우드 환경에서 현대적이고 강력한 보안 아키텍쳐 구축을 위한 포괄적 가이드</p>
        </header>

        <nav>
            <ul>
                <li><a href="#principles">보안 원칙</a></li>
                <li><a href="#accounts">계정 관리</a></li>
                <li><a href="#network">네트워크</a></li>
                <li><a href="#data">데이터 보호</a></li>
                <li><a href="#iam">IAM</a></li>
                <li><a href="#detection">위협 탐지</a></li>
                <li><a href="#application">애플리케이션</a></li>
                <li><a href="#compliance">컴플라이언스</a></li>
                <li><a href="#incident">인시던트 대응</a></li>
                <li><a href="#serverless">서버리스</a></li>
                <li><a href="#container">컨테이너</a></li>
                <li><a href="#automation">자동화</a></li>
            </ul>
        </nav>

        <main>
            <!-- Section 1: 핵심 보안 원칙 -->
            <section id="principles">
                <h2>1. 핵심 보안 원칙</h2>
                
                <h3>Zero Trust 아키텍쳐</h3>
                <div class="info-box">
                    <strong>핵심 원칙:</strong> "절대 신뢰하지 말고, 항상 검증하라 (Never Trust, Always Verify)"
                </div>
                <ul>
                    <li>네트워크 위치와 관계없이 모든 접근 요청을 검증</li>
                    <li>최소 권한 원칙(Least Privilege) 엄격 적용</li>
                    <li>마이크로 세그멘테이션을 통한 공격 표면 최소화</li>
                    <li>연속적인 모니터링 및 검증</li>
                </ul>

                <h3>Defense in Depth (다층 방어)</h3>
                <ul>
                    <li>여러 보안 계층을 통한 중첩된 방어 체계 구축</li>
                    <li>단일 실패 지점(Single Point of Failure) 제거</li>
                    <li>각 계층별 독립적인 보안 통제 메커니즘</li>
                    <li>계층 간 상호 보완적 보안 정책</li>
                </ul>
            </section>

            <!-- Section 2: 계정 및 조직 보안 -->
            <section id="accounts">
                <h2>2. 계정 및 조직 보안</h2>
                
                <h3>AWS Organizations 구조</h3>
                <div class="architecture-diagram">Root Organization Unit (OU)
├── Security OU
│   ├── Log Archive Account (중앙 로그 저장소)
│   ├── Security Tooling Account (보안 도구)
│   └── Audit Account (감사 및 컴플라이언스)
│
├── Infrastructure OU
│   ├── Network Account (전사 네트워크 관리)
│   ├── Shared Services Account (공유 서비스)
│   └── DNS Account (Route 53 관리)
│
└── Workload OU
    ├── Production Account (운영 환경)
    ├── Staging Account (스테이징 환경)
    └── Development Account (개발 환경)</div>

                <h3>주요 설정 및 구성</h3>
                <ul>
                    <li><strong>SCP (Service Control Policies)</strong>: 조직 전체에 적용되는 권한 경계 설정</li>
                    <li><strong>AWS Control Tower</strong>: 멀티 어카운트 환경의 거버넌스 자동화</li>
                    <li><strong>계정별 역할 분리 (RBAC)</strong>: 역할 기반 접근 제어 구현</li>
                    <li><strong>통합 빌링</strong>: 비용 가시성 및 예산 관리</li>
                </ul>

                <div class="success-box">
                    <strong>모범 사례:</strong> 환경별(Dev/Stage/Prod), 팀별, 프로젝트별로 AWS 계정을 분리하여 보안 경계를 명확히 합니다.
                </div>
            </section>

            <!-- Section 3: 네트워크 보안 -->
            <section id="network">
                <h2>3. 네트워크 보안 아키텍쳐</h2>
                
                <h3>VPC 설계 패턴</h3>
                <div class="architecture-diagram">Internet Gateway / NAT Gateway
         ↓
[Public Subnet - Tier 1]
  - Application Load Balancer (ALB)
  - NAT Gateway
  - Bastion Host (Session Manager 권장)
         ↓
[Private Subnet - Tier 2]
  - Application Servers (EC2, ECS, EKS)
  - Lambda Functions
  - API Gateway
         ↓
[Isolated Subnet - Tier 3]
  - RDS Databases
  - ElastiCache
  - DocumentDB</div>

                <h3>핵심 네트워크 보안 구성요소</h3>
                
                <h4>AWS Network Firewall</h4>
                <ul>
                    <li>상태 저장(Stateful) 방화벽 규칙 엔진</li>
                    <li>침입 탐지 및 방지 시스템 (IDS/IPS)</li>
                    <li>도메인 기반 필터링 (악성 도메인 차단)</li>
                    <li>Suricata 호환 규칙 지원</li>
                </ul>

                <h4>Security Groups vs NACLs</h4>
                <table>
                    <thead>
                        <tr>
                            <th>특성</th>
                            <th>Security Groups</th>
                            <th>Network ACLs</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>작동 계층</td>
                            <td>인스턴스 레벨</td>
                            <td>서브넷 레벨</td>
                        </tr>
                        <tr>
                            <td>상태</td>
                            <td>Stateful (상태 저장)</td>
                            <td>Stateless (상태 비저장)</td>
                        </tr>
                        <tr>
                            <td>규칙 타입</td>
                            <td>허용 규칙만</td>
                            <td>허용 및 거부 규칙</td>
                        </tr>
                        <tr>
                            <td>평가 순서</td>
                            <td>모든 규칙 평가</td>
                            <td>번호 순서대로 평가</td>
                        </tr>
                    </tbody>
                </table>

                <h4>VPC Flow Logs</h4>
                <div class="code-block"># VPC Flow Logs 구성 예시
resource "aws_flow_log" "main" {
  log_destination      = aws_s3_bucket.flow_logs.arn
  log_destination_type = "s3"
  traffic_type         = "ALL"
  vpc_id               = aws_vpc.main.id

  tags = {
    Name        = "vpc-flow-logs"
    Environment = "production"
  }
}</div>
            </section>

            <!-- Section 4: 데이터 보호 -->
            <section id="data">
                <h2>4. 데이터 보호</h2>
                
                <h3>암호화 전략</h3>
                
                <h4>전송 중 암호화 (Encryption in Transit)</h4>
                <ul>
                    <li><strong>TLS 1.2 이상 강제</strong>: 모든 데이터 전송 시 TLS 프로토콜 사용</li>
                    <li><strong>AWS Certificate Manager (ACM)</strong>: SSL/TLS 인증서 자동 관리</li>
                    <li><strong>VPN / Direct Connect</strong>: 온프레미스와의 안전한 연결</li>
                    <li><strong>PrivateLink</strong>: AWS 서비스에 대한 프라이빗 연결</li>
                </ul>

                <h4>저장 데이터 암호화 (Encryption at Rest)</h4>
                <ul>
                    <li><strong>AWS KMS (Key Management Service)</strong>: 중앙 집중식 키 관리</li>
                    <li><strong>Customer Managed Keys (CMK)</strong>: 고객 관리형 키 사용</li>
                    <li><strong>자동 키 로테이션</strong>: 연 1회 자동 키 교체</li>
                    <li><strong>CloudHSM</strong>: FIPS 140-2 Level 3 준수가 필요한 경우</li>
                </ul>

                <h3>데이터 분류 및 보호 수준</h3>
                <table>
                    <thead>
                        <tr>
                            <th>분류</th>
                            <th>암호화</th>
                            <th>접근 제어</th>
                            <th>로깅</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Public</td>
                            <td>선택 사항</td>
                            <td>공개 읽기</td>
                            <td>기본</td>
                        </tr>
                        <tr>
                            <td>Internal</td>
                            <td>SSE (서버 측 암호화)</td>
                            <td>조직 내부만</td>
                            <td>기본</td>
                        </tr>
                        <tr>
                            <td>Confidential</td>
                            <td>CMK + 전송 중 암호화</td>
                            <td>승인된 팀만</td>
                            <td>상세 로깅</td>
                        </tr>
                        <tr>
                            <td>Restricted</td>
                            <td>CMK + VPC Endpoint</td>
                            <td>최소 권한 + MFA</td>
                            <td>실시간 모니터링</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <strong>중요:</strong> S3 버킷의 경우 기본 암호화를 활성화하고, 공개 액세스를 차단하는 것이 필수입니다.
                </div>

                <h3>S3 보안 구성 예시</h3>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyUnencryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-secure-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    },
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-secure-bucket",
        "arn:aws:s3:::my-secure-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}</div>
            </section>

            <!-- Section 5: IAM -->
            <section id="iam">
                <h2>5. 식별 및 접근 관리 (IAM)</h2>
                
                <h3>IAM 모범 사례</h3>
                
                <div class="success-box">
                    <strong>핵심 원칙:</strong>
                    <ul style="margin-top: 10px;">
                        <li>루트 계정 사용 금지 (MFA 활성화 후 잠금)</li>
                        <li>개별 사용자에게 고유 자격 증명 부여</li>
                        <li>그룹을 통한 권한 관리</li>
                        <li>최소 권한 원칙 적용</li>
                        <li>정기적인 권한 검토 및 감사</li>
                    </ul>
                </div>

                <h3>역할 기반 접근 제어 (RBAC) 정책 예시</h3>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowS3ReadWrite",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::my-app-bucket",
        "arn:aws:s3:::my-app-bucket/*"
      ],
      "Condition": {
        "StringEquals": {
          "aws:PrincipalOrgID": "o-xxxxxxxxx"
        },
        "IpAddress": {
          "aws:SourceIp": [
            "10.0.0.0/8",
            "172.16.0.0/12"
          ]
        }
      }
    },
    {
      "Sid": "DenyDeleteActions",
      "Effect": "Deny",
      "Action": [
        "s3:DeleteObject",
        "s3:DeleteBucket"
      ],
      "Resource": "*"
    }
  ]
}</div>

                <h3>IAM 권장 구성</h3>
                <ul>
                    <li><strong>MFA (Multi-Factor Authentication)</strong>: 모든 사용자 및 루트 계정에 필수 활성화</li>
                    <li><strong>IAM Access Analyzer</strong>: 외부와 공유되는 리소스 자동 탐지</li>
                    <li><strong>권한 경계 (Permission Boundaries)</strong>: 사용자 및 역할의 최대 권한 제한</li>
                    <li><strong>서비스 제어 정책 (SCP)</strong>: 조직 수준의 가드레일</li>
                    <li><strong>임시 자격 증명</strong>: 장기 액세스 키 대신 STS 사용</li>
                </ul>

                <h3>AWS IAM Identity Center (AWS SSO)</h3>
                <div class="info-box">
                    <strong>장점:</strong>
                    <ul style="margin-top: 10px;">
                        <li>중앙 집중식 사용자 접근 관리</li>
                        <li>SAML 2.0 기반 페더레이션 (Azure AD, Okta 등)</li>
                        <li>임시 자격 증명 자동 발급</li>
                        <li>다중 계정 접근을 위한 통합 포털</li>
                        <li>권한 세트를 통한 표준화된 권한 관리</li>
                    </ul>
                </div>

                <h3>IAM 정책 테스트 도구</h3>
                <ul>
                    <li><strong>IAM Policy Simulator</strong>: 정책 효과 사전 테스트</li>
                    <li><strong>Access Advisor</strong>: 마지막 사용 시간 기반 권한 정리</li>
                    <li><strong>CloudTrail</strong>: 실제 API 호출 기록 분석</li>
                </ul>
            </section>

            <!-- Section 6: 위협 탐지 및 대응 -->
            <section id="detection">
                <h2>6. 위협 탐지 및 대응</h2>
                
                <h3>보안 모니터링 스택</h3>
                
                <h4>Amazon GuardDuty</h4>
                <ul>
                    <li><strong>지능형 위협 탐지</strong>: 머신러닝 기반 이상 행위 탐지</li>
                    <li><strong>데이터 소스</strong>: VPC Flow Logs, CloudTrail, DNS 로그</li>
                    <li><strong>위협 인텔리전스</strong>: AWS 및 외부 위협 데이터베이스 활용</li>
                    <li><strong>주요 탐지 항목</strong>:
                        <ul>
                            <li>비정상적인 API 호출</li>
                            <li>암호화폐 채굴 활동</li>
                            <li>악성 IP 통신</li>
                            <li>무차별 대입 공격 (Brute Force)</li>
                        </ul>
                    </li>
                </ul>

                <h4>AWS Security Hub</h4>
                <ul>
                    <li><strong>통합 보안 대시보드</strong>: 모든 보안 도구의 결과 집계</li>
                    <li><strong>자동화된 컴플라이언스 점검</strong>: CIS, PCI-DSS, AWS FSBP</li>
                    <li><strong>보안 점수</strong>: 전체 보안 태세의 정량적 평가</li>
                    <li><strong>통합 서비스</strong>: GuardDuty, Inspector, Macie, IAM Access Analyzer 등</li>
                </ul>

                <h4>Amazon Detective</h4>
                <ul>
                    <li><strong>보안 사고 조사</strong>: 근본 원인 분석</li>
                    <li><strong>시각화된 그래프</strong>: 리소스 간 관계 및 활동 패턴</li>
                    <li><strong>기계 학습 분석</strong>: 정상 기준선 대비 이상 행위 식별</li>
                </ul>

                <h3>통합 SIEM 아키텍쳐</h3>
                <div class="architecture-diagram">┌──────────────┐
│ CloudTrail   │──┐
└──────────────┘  │
┌──────────────┐  │
│ GuardDuty    │──┤
└──────────────┘  │
┌──────────────┐  │     ┌────────────┐     ┌────────┐     ┌──────────────┐
│ Security Hub │──┼────→│ EventBridge│────→│ Lambda │────→│ SIEM/SOAR    │
└──────────────┘  │     └────────────┘     └────────┘     │ (Splunk/ELK) │
┌──────────────┐  │                                        └──────────────┘
│ AWS Config   │──┤
└──────────────┘  │
┌──────────────┐  │
│ Macie        │──┘
└──────────────┘</div>

                <h3>자동화된 보안 응답 워크플로우</h3>
                <div class="code-block"># EventBridge 규칙 예시 (Terraform)
resource "aws_cloudwatch_event_rule" "guardduty_findings" {
  name        = "guardduty-high-severity"
  description = "Trigger on high severity GuardDuty findings"

  event_pattern = jsonencode({
    source      = ["aws.guardduty"]
    detail-type = ["GuardDuty Finding"]
    detail = {
      severity = [7, 8, 9]  # High and Critical
    }
  })
}

resource "aws_cloudwatch_event_target" "lambda" {
  rule      = aws_cloudwatch_event_rule.guardduty_findings.name
  target_id = "SendToLambda"
  arn       = aws_lambda_function.security_response.arn
}</div>

                <div class="warning-box">
                    <strong>권장 사항:</strong> GuardDuty와 Security Hub는 모든 리전에서 활성화하고, 중앙 집중식 관리를 위해 delegated administrator를 설정하세요.
                </div>
            </section>

            <!-- Section 7: 애플리케이션 보안 -->
            <section id="application">
                <h2>7. 애플리케이션 보안</h2>
                
                <h3>AWS WAF (Web Application Firewall)</h3>
                
                <h4>핵심 WAF 규칙 세트</h4>
                <table>
                    <thead>
                        <tr>
                            <th>규칙 유형</th>
                            <th>설명</th>
                            <th>우선순위</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Rate Limiting</td>
                            <td>IP당 요청 수 제한 (DDoS 방어)</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>SQL Injection</td>
                            <td>SQL 인젝션 공격 패턴 차단</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>XSS (Cross-Site Scripting)</td>
                            <td>크로스 사이트 스크립팅 방어</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>Geo Blocking</td>
                            <td>특정 국가/지역 차단</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>Bot Control</td>
                            <td>악성 봇 탐지 및 관리</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>IP Reputation</td>
                            <td>알려진 악성 IP 차단</td>
                            <td>높음</td>
                        </tr>
                    </tbody>
                </table>

                <h4>AWS Managed Rules 활용</h4>
                <div class="code-block"># WAF v2 구성 예시 (Terraform)
resource "aws_wafv2_web_acl" "main" {
  name  = "web-acl-production"
  scope = "REGIONAL"

  default_action {
    allow {}
  }

  # Core Rule Set (CRS)
  rule {
    name     = "AWS-AWSManagedRulesCommonRuleSet"
    priority = 1

    override_action {
      none {}
    }

    statement {
      managed_rule_group_statement {
        vendor_name = "AWS"
        name        = "AWSManagedRulesCommonRuleSet"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                = "AWSManagedRulesCommonRuleSetMetric"
      sampled_requests_enabled   = true
    }
  }

  # Rate Limiting
  rule {
    name     = "RateLimitRule"
    priority = 2

    action {
      block {}
    }

    statement {
      rate_based_statement {
        limit              = 2000
        aggregate_key_type = "IP"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                = "RateLimitMetric"
      sampled_requests_enabled   = true
    }
  }
}</div>

                <h3>AWS Shield</h3>
                <ul>
                    <li><strong>Shield Standard</strong>: 모든 AWS 고객에게 자동 제공되는 L3/L4 DDoS 방어</li>
                    <li><strong>Shield Advanced</strong>:
                        <ul>
                            <li>고급 DDoS 방어 (L7 포함)</li>
                            <li>24/7 DDoS Response Team (DRT) 지원</li>
                            <li>비용 보호 (DDoS 공격 시 스케일링 비용 환불)</li>
                            <li>실시간 공격 알림 및 상세 리포트</li>
                        </ul>
                    </li>
                </ul>

                <h3>시크릿 관리 (Secrets Management)</h3>
                
                <h4>AWS Secrets Manager</h4>
                <ul>
                    <li>데이터베이스 자격 증명 자동 로테이션</li>
                    <li>API 키, OAuth 토큰 등 안전한 저장</li>
                    <li>세밀한 액세스 제어 (IAM 정책)</li>
                    <li>암호화 및 감사 로깅</li>
                </ul>

                <h4>Systems Manager Parameter Store</h4>
                <ul>
                    <li>계층적 파라미터 구조</li>
                    <li>무료 티어 제공 (표준 파라미터)</li>
                    <li>KMS 암호화 지원</li>
                    <li>버전 관리</li>
                </ul>

                <div class="warning-box">
                    <strong>절대 금지:</strong> 
                    <ul style="margin-top: 10px;">
                        <li>애플리케이션 코드에 자격 증명 하드코딩</li>
                        <li>환경 변수에 평문으로 저장</li>
                        <li>Git 저장소에 시크릿 커밋</li>
                        <li>장기 액세스 키 사용 (IAM Role 사용 권장)</li>
                    </ul>
                </div>

                <h3>애플리케이션 보안 모범 사례</h3>
                <div class="code-block"># Secrets Manager 사용 예시 (Python)
import boto3
import json

def get_secret():
    secret_name = "prod/database/credentials"
    region_name = "us-east-1"

    session = boto3.session.Session()
    client = session.client(
        service_name='secretsmanager',
        region_name=region_name
    )

    try:
        get_secret_value_response = client.get_secret_value(
            SecretId=secret_name
        )
    except ClientError as e:
        raise e

    secret = json.loads(get_secret_value_response['SecretString'])
    return secret

# 사용
db_credentials = get_secret()
username = db_credentials['username']
password = db_credentials['password']</div>
            </section>

            <!-- Section 8: 컴플라이언스 및 거버넌스 -->
            <section id="compliance">
                <h2>8. 컴플라이언스 및 거버넌스</h2>
                
                <h3>AWS Config</h3>
                
                <h4>핵심 Config 규칙</h4>
                <table>
                    <thead>
                        <tr>
                            <th>규칙</th>
                            <th>점검 내용</th>
                            <th>심각도</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>encrypted-volumes</td>
                            <td>EBS 볼륨 암호화 여부</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>s3-bucket-public-read-prohibited</td>
                            <td>S3 버킷 공개 읽기 차단</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>rds-storage-encrypted</td>
                            <td>RDS 인스턴스 암호화</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>iam-user-unused-credentials-check</td>
                            <td>미사용 IAM 자격 증명</td>
                            <td>중간</td>
                        </tr>
                        <tr>
                            <td>restricted-ssh</td>
                            <td>SSH 포트(22) 전체 개방 여부</td>
                            <td>높음</td>
                        </tr>
                        <tr>
                            <td>cloudtrail-enabled</td>
                            <td>CloudTrail 활성화 여부</td>
                            <td>높음</td>
                        </tr>
                    </tbody>
                </table>

                <h4>자동 준수 점검 및 교정</h4>
                <div class="architecture-diagram">AWS Config Rule 위반 감지
         ↓
Systems Manager Automation
         ↓
자동 교정 작업 실행
    (예: 공개 S3 버킷 비공개로 변경)
         ↓
SNS 알림 발송
         ↓
Security Hub에 결과 전송</div>

                <h3>감사 및 로깅</h3>
                
                <h4>AWS CloudTrail 구성</h4>
                <ul>
                    <li><strong>다중 리전 추적</strong>: 모든 리전의 이벤트 기록</li>
                    <li><strong>조직 추적</strong>: Organizations의 모든 계정 로그 중앙 집중</li>
                    <li><strong>로그 파일 무결성 검증</strong>: 로그 변조 탐지</li>
                    <li><strong>S3 버킷 보안</strong>:
                        <ul>
                            <li>버킷 암호화 (SSE-KMS)</li>
                            <li>MFA Delete 활성화</li>
                            <li>버킷 정책으로 삭제 방지</li>
                            <li>객체 잠금 (WORM)</li>
                        </ul>
                    </li>
                </ul>

                <h4>CloudTrail S3 버킷 정책 예시</h4>
                <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AWSCloudTrailAclCheck",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudtrail.amazonaws.com"
      },
      "Action": "s3:GetBucketAcl",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket"
    },
    {
      "Sid": "AWSCloudTrailWrite",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudtrail.amazonaws.com"
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket/*",
      "Condition": {
        "StringEquals": {
          "s3:x-amz-acl": "bucket-owner-full-control"
        }
      }
    },
    {
      "Sid": "DenyUnencryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-cloudtrail-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    },
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-cloudtrail-bucket",
        "arn:aws:s3:::my-cloudtrail-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}</div>

                <h3>컴플라이언스 프레임워크</h3>
                <ul>
                    <li><strong>CIS AWS Foundations Benchmark</strong>: 보안 모범 사례 체크리스트</li>
                    <li><strong>PCI-DSS</strong>: 카드 결제 데이터 보안 표준</li>
                    <li><strong>HIPAA</strong>: 의료 정보 보호 규정</li>
                    <li><strong>GDPR</strong>: EU 개인정보 보호 규정</li>
                    <li><strong>SOC 2</strong>: 서비스 조직 통제 보고서</li>
                </ul>

                <div class="info-box">
                    <strong>AWS Artifact:</strong> AWS의 컴플라이언스 보고서 및 계약을 다운로드할 수 있는 셀프 서비스 포털입니다. ISO 인증서, SOC 보고서 등을 확인할 수 있습니다.
                </div>
            </section>

            <!-- Section 9: 인시던트 대응 -->
            <section id="incident">
                <h2>9. 인시던트 대응 플레이북</h2>
                
                <h3>자동화된 인시던트 대응 워크플로우</h3>
                
                <h4>시나리오 1: 의심스러운 IAM 활동 탐지</h4>
                <div class="architecture-diagram">1. GuardDuty: UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration
         ↓
2. EventBridge 규칙 트리거
         ↓
3. Lambda 함수 실행
         ↓
4. 자동 대응 작업:
   ├─ IAM 사용자/역할 정책 격리 (권한 제거)
   ├─ 액세스 키 비활성화
   ├─ SNS/PagerDuty 알림
   ├─ JIRA 티켓 자동 생성
   └─ 관련 EC2 인스턴스 스냅샷 (포렌식)
         ↓
5. Security Hub에 조사 결과 기록
         ↓
6. Detective로 상세 분석</div>

                <h4>Lambda 자동 대응 함수 예시</h4>
                <div class="code-block">import boto3
import json

iam = boto3.client('iam')
sns = boto3.client('sns')

def lambda_handler(event, context):
    # GuardDuty 이벤트 파싱
    finding = event['detail']
    severity = finding['severity']
    finding_type = finding['type']
    
    # 높은 심각도만 처리
    if severity >= 7:
        # 영향받은 IAM 사용자 추출
        if 'resource' in finding:
            resource = finding['resource']
            if resource['resourceType'] == 'AccessKey':
                access_key_id = resource['accessKeyDetails']['accessKeyId']
                user_name = resource['accessKeyDetails']['userName']
                
                # 1. 액세스 키 비활성화
                try:
                    iam.update_access_key(
                        UserName=user_name,
                        AccessKeyId=access_key_id,
                        Status='Inactive'
                    )
                    print(f"Disabled access key: {access_key_id}")
                except Exception as e:
                    print(f"Error disabling key: {e}")
                
                # 2. 사용자 정책 격리
                isolation_policy = {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Deny",
                            "Action": "*",
                            "Resource": "*"
                        }
                    ]
                }
                
                try:
                    iam.put_user_policy(
                        UserName=user_name,
                        PolicyName='SecurityIncidentIsolation',
                        PolicyDocument=json.dumps(isolation_policy)
                    )
                    print(f"Isolated user: {user_name}")
                except Exception as e:
                    print(f"Error isolating user: {e}")
                
                # 3. SNS 알림
                message = f"""
                SECURITY ALERT - High Severity Finding
                
                Type: {finding_type}
                Severity: {severity}
                User: {user_name}
                Access Key: {access_key_id}
                
                Automated Actions Taken:
                - Access key disabled
                - User permissions isolated
                - Incident ticket created
                
                Please investigate immediately.
                """
                
                sns.publish(
                    TopicArn='arn:aws:sns:us-east-1:123456789012:SecurityAlerts',
                    Subject='URGENT: Security Incident Detected',
                    Message=message
                )
    
    return {
        'statusCode': 200,
        'body': json.dumps('Incident response completed')
    }</div>

                <h3>인시던트 대응 5단계 프로세스</h3>
                <table>
                    <thead>
                        <tr>
                            <th>단계</th>
                            <th>활동</th>
                            <th>도구</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. 탐지</td>
                            <td>보안 이벤트 식별 및 분류</td>
                            <td>GuardDuty, Security Hub, CloudWatch</td>
                        </tr>
                        <tr>
                            <td>2. 격리</td>
                            <td>영향받은 리소스 분리</td>
                            <td>Security Groups, IAM, Lambda</td>
                        </tr>
                        <tr>
                            <td>3. 조사</td>
                            <td>근본 원인 및 영향 범위 분석</td>
                            <td>Detective, CloudTrail, VPC Flow Logs</td>
                        </tr>
                        <tr>
                            <td>4. 복구</td>
                            <td>안전한 상태로 복원</td>
                            <td>AWS Backup, Snapshots, CloudFormation</td>
                        </tr>
                        <tr>
                            <td>5. 사후 검토</td>
                            <td>교훈 도출 및 프로세스 개선</td>
                            <td>문서화, 플레이북 업데이트</td>
                        </tr>
                    </tbody>
                </table>

                <h3>포렌식 준비</h3>
                <ul>
                    <li><strong>스냅샷 자동화</strong>: 의심 활동 감지 시 EBS 스냅샷 자동 생성</li>
                    <li><strong>로그 보존</strong>: CloudTrail 로그 최소 1년 이상 보관</li>
                    <li><strong>메모리 덤프</strong>: SSM Run Command를 통한 원격 메모리 수집</li>
                    <li><strong>네트워크 트래픽</strong>: VPC Traffic Mirroring 활용</li>
                </ul>

                <div class="warning-box">
                    <strong>중요:</strong> 인시던트 대응 플레이북은 정기적으로 테스트하고 업데이트해야 합니다. 최소 분기별 1회 모의 훈련을 권장합니다.
                </div>
            </section>

            <!-- Section 10: 서버리스 보안 -->
            <section id="serverless">
                <h2>10. 서버리스 보안</h2>
                
                <h3>AWS Lambda 보안 모범 사례</h3>
                
                <h4>1. 네트워크 격리</h4>
                <ul>
                    <li><strong>VPC 내 Lambda 실행</strong>: 민감한 리소스 접근 시</li>
                    <li><strong>Private Subnet 배치</strong>: NAT Gateway를 통한 인터넷 접근</li>
                    <li><strong>Security Group 최소화</strong>: 필요한 포트만 개방</li>
                    <li><strong>VPC Endpoints</strong>: AWS 서비스 접근 시 프라이빗 연결</li>
                </ul>

                <h4>2. 코드 보안</h4>
                <div class="code-block"># Lambda 함수 보안 구성 예시 (Python)
import os
import boto3
from aws_lambda_powertools import Logger, Tracer
from aws_lambda_powertools.utilities import parameters

logger = Logger()
tracer = Tracer()

# Secrets Manager에서 시크릿 가져오기
def get_database_credentials():
    secret_name = os.environ['DB_SECRET_NAME']
    return parameters.get_secret(secret_name)

@tracer.capture_lambda_handler
@logger.inject_lambda_context
def lambda_handler(event, context):
    # 입력 검증
    if 'user_id' not in event:
        logger.error("Missing required parameter: user_id")
        return {
            'statusCode': 400,
            'body': 'Bad Request'
        }
    
    user_id = event['user_id']
    
    # SQL 인젝션 방지: 파라미터화된 쿼리 사용
    # XSS 방지: 출력 인코딩
    # ...
    
    logger.info(f"Processing request for user: {user_id}")
    
    return {
        'statusCode': 200,
        'body': 'Success'
    }</div>

                <h4>3. IAM 권한 최소화</h4>
                <div class="code-block"># Lambda 실행 역할 (Terraform)
resource "aws_iam_role" "lambda_role" {
  name = "lambda-execution-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = "sts:AssumeRole"
        Effect = "Allow"
        Principal = {
          Service = "lambda.amazonaws.com"
        }
      }
    ]
  })
}

# 최소 권한 정책
resource "aws_iam_role_policy" "lambda_policy" {
  name = "lambda-policy"
  role = aws_iam_role.lambda_role.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ]
        Resource = "arn:aws:logs:*:*:*"
      },
      {
        Effect = "Allow"
        Action = [
          "dynamodb:GetItem",
          "dynamodb:PutItem"
        ]
        Resource = "arn:aws:dynamodb:us-east-1:123456789012:table/MyTable"
      }
    ]
  })
}</div>

                <h4>4. 환경 변수 암호화</h4>
                <ul>
                    <li>KMS를 사용한 환경 변수 암호화</li>
                    <li>Secrets Manager 또는 Parameter Store 사용 권장</li>
                    <li>런타임 시 복호화</li>
                </ul>

                <h3>API Gateway 보안</h3>
                
                <h4>인증 및 권한 부여 계층</h4>
                <div class="architecture-diagram">Client Request
      ↓
[1] AWS WAF (DDoS, SQL Injection 방어)
      ↓
[2] API Gateway
      ├─ Resource Policy (IP 제한, VPC 제한)
      ├─ Usage Plans & API Keys (Rate Limiting)
      └─ Authorizers
          ├─ Lambda Authorizer (커스텀 로직)
          └─ Cognito User Pools (OAuth 2.0)
      ↓
[3] Backend (Lambda, ECS, HTTP)
      ↓
Response</div>

                <h4>API Gateway 보안 설정</h4>
                <table>
                    <thead>
                        <tr>
                            <th>보안 기능</th>
                            <th>설명</th>
                            <th>사용 사례</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Lambda Authorizer</td>
                            <td>커스텀 인증 로직 실행</td>
                            <td>JWT 검증, 외부 IdP 통합</td>
                        </tr>
                        <tr>
                            <td>Cognito User Pools</td>
                            <td>완전 관리형 사용자 인증</td>
                            <td>표준 OAuth 2.0/OIDC</td>
                        </tr>
                        <tr>
                            <td>IAM Authentication</td>
                            <td>AWS 자격 증명 기반</td>
                            <td>내부 서비스 간 통신</td>
                        </tr>
                        <tr>
                            <td>API Keys</td>
                            <td>간단한 키 기반 접근</td>
                            <td>파트너 API, 사용량 추적</td>
                        </tr>
                        <tr>
                            <td>Resource Policies</td>
                            <td>리소스 기반 접근 제어</td>
                            <td>VPC/IP 화이트리스트</td>
                        </tr>
                    </tbody>
                </table>

                <h4>API Gateway Lambda Authorizer 예시</h4>
                <div class="code-block">import jwt
import os

def lambda_handler(event, context):
    token = event['authorizationToken']
    
    try:
        # JWT 토큰 검증
        decoded = jwt.decode(
            token,
            os.environ['JWT_SECRET'],
            algorithms=['HS256']
        )
        
        # 정책 생성
        policy = generate_policy(
            decoded['sub'],  # principalId
            'Allow',
            event['methodArn']
        )
        
        # 컨텍스트에 사용자 정보 추가
        policy['context'] = {
            'userId': decoded['sub'],
            'email': decoded['email'],
            'role': decoded['role']
        }
        
        return policy
    
    except jwt.ExpiredSignatureError:
        raise Exception('Unauthorized: Token expired')
    except jwt.InvalidTokenError:
        raise Exception('Unauthorized: Invalid token')

def generate_policy(principal_id, effect, resource):
    return {
        'principalId': principal_id,
        'policyDocument': {
            'Version': '2012-10-17',
            'Statement': [
                {
                    'Action': 'execute-api:Invoke',
                    'Effect': effect,
                    'Resource': resource
                }
            ]
        }
    }</div>

                <h3>서버리스 보안 체크리스트</h3>
                <ul class="checklist">
                    <li>Lambda 함수에 최소 권한 IAM 역할 할당</li>
                    <li>환경 변수 암호화 활성화</li>
                    <li>VPC 내 Lambda 배치 (필요시)</li>
                    <li>Dead Letter Queue (DLQ) 구성</li>
                    <li>Reserved Concurrency 설정 (DoS 방지)</li>
                    <li>X-Ray 추적 활성화</li>
                    <li>CloudWatch Logs 암호화</li>
                    <li>API Gateway에 WAF 연결</li>
                    <li>Rate Limiting 및 Throttling 설정</li>
                    <li>CORS 정책 엄격히 구성</li>
                </ul>
            </section>

            <!-- Section 11: 컨테이너 보안 -->
            <section id="container">
                <h2>11. 컨테이너 보안</h2>
                
                <h3>Amazon EKS 보안 아키텍쳐</h3>
                
                <h4>다층 보안 계층</h4>
                <div class="architecture-diagram">┌─────────────────────────────────────────┐
│  Pod Security Standards (PSS)           │
│  - Baseline, Restricted Policies        │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Network Policies (Calico/Cilium)       │
│  - Pod-to-Pod 트래픽 제어               │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  IRSA (IAM Roles for Service Accounts)  │
│  - Pod별 세밀한 권한 관리               │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Secrets Management                      │
│  - External Secrets Operator            │
│  - AWS Secrets Manager 통합             │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Image Scanning (ECR)                    │
│  - 빌드 시 취약점 스캔                  │
└─────────────────────────────────────────┘</div>

                <h3>주요 컨테이너 보안 도구</h3>
                
                <h4>1. Amazon ECR Image Scanning</h4>
                <ul>
                    <li><strong>Basic Scanning</strong>: Clair 기반 취약점 스캔</li>
                    <li><strong>Enhanced Scanning</strong>: Amazon Inspector 통합, 지속적 스캔</li>
                    <li><strong>스캔 정책</strong>: 푸시 시 자동 스캔 또는 스케줄 기반</li>
                    <li><strong>CVE 데이터베이스</strong>: 최신 취약점 정보 자동 업데이트</li>
                </ul>

                <div class="code-block"># ECR 리포지토리 생성 및 스캔 설정 (Terraform)
resource "aws_ecr_repository" "app" {
  name                 = "my-application"
  image_tag_mutability = "IMMUTABLE"

  image_scanning_configuration {
    scan_on_push = true
  }

  encryption_configuration {
    encryption_type = "KMS"
    kms_key        = aws_kms_key.ecr.arn
  }
}

# 라이프사이클 정책 (오래된 이미지 자동 삭제)
resource "aws_ecr_lifecycle_policy" "app" {
  repository = aws_ecr_repository.app.name

  policy = jsonencode({
    rules = [
      {
        rulePriority = 1
        description  = "Keep last 10 images"
        selection = {
          tagStatus   = "any"
          countType   = "imageCountMoreThan"
          countNumber = 10
        }
        action = {
          type = "expire"
        }
      }
    ]
  })
}</div>

                <h4>2. Falco - 런타임 보안 모니터링</h4>
                <ul>
                    <li>실시간 시스템 콜 모니터링</li>
                    <li>비정상 행위 탐지 (파일 접근, 프로세스 실행 등)</li>
                    <li>사전 정의된 보안 규칙</li>
                    <li>Kubernetes 이벤트 통합</li>
                </ul>

                <div class="code-block"># Falco 규칙 예시
- rule: Unauthorized Process in Container
  desc: Detect unexpected process in container
  condition: >
    spawned_process and 
    container and 
    not proc.name in (allowed_processes)
  output: >
    Unauthorized process started in container 
    (user=%user.name command=%proc.cmdline container=%container.name 
    image=%container.image.repository)
  priority: WARNING

- rule: Write below root
  desc: Attempt to write to root filesystem
  condition: >
    open_write and 
    container and 
    fd.name startswith /
  output: >
    Write attempt to root filesystem 
    (user=%user.name command=%proc.cmdline file=%fd.name)
  priority: ERROR</div>

                <h4>3. OPA/Gatekeeper - 정책 기반 거버넌스</h4>
                <ul>
                    <li>Admission Controller를 통한 정책 강제</li>
                    <li>선언적 정책 정의 (Rego 언어)</li>
                    <li>리소스 생성 시 자동 검증</li>
                </ul>

                <div class="code-block"># Gatekeeper Constraint Template 예시
apiVersion: templates.gatekeeper.sh/v1
kind: ConstraintTemplate
metadata:
  name: k8srequiredlabels
spec:
  crd:
    spec:
      names:
        kind: K8sRequiredLabels
      validation:
        openAPIV3Schema:
          type: object
          properties:
            labels:
              type: array
              items:
                type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package k8srequiredlabels
        
        violation[{"msg": msg, "details": {"missing_labels": missing}}] {
          provided := {label | input.review.object.metadata.labels[label]}
          required := {label | label := input.parameters.labels[_]}
          missing := required - provided
          count(missing) > 0
          msg := sprintf("You must provide labels: %v", [missing])
        }

---
# Constraint 적용
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sRequiredLabels
metadata:
  name: pod-must-have-labels
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
  parameters:
    labels:
      - "app"
      - "environment"
      - "owner"</div>

                <h3>IRSA (IAM Roles for Service Accounts)</h3>
                <div class="code-block"># ServiceAccount 생성
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-app-sa
  namespace: production
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/my-app-role

---
# Pod에서 ServiceAccount 사용
apiVersion: v1
kind: Pod
metadata:
  name: my-app
  namespace: production
spec:
  serviceAccountName: my-app-sa
  containers:
  - name: app
    image: my-app:latest
    # 이제 Pod는 IAM 역할의 권한을 자동으로 사용
    # AWS SDK가 자동으로 임시 자격 증명 획득</div>

                <h3>컨테이너 보안 모범 사례</h3>
                <ul class="checklist">
                    <li>최소 권한 원칙으로 컨테이너 실행 (non-root 사용자)</li>
                    <li>읽기 전용 루트 파일시스템 사용</li>
                    <li>불필요한 Linux Capabilities 제거</li>
                    <li>리소스 제한 (CPU, Memory) 설정</li>
                    <li>프라이빗 ECR 리포지토리 사용</li>
                    <li>이미지 서명 및 검증 (Notary/Cosign)</li>
                    <li>Network Policies로 Pod 간 트래픽 제한</li>
                    <li>Pod Security Standards 적용</li>
                    <li>정기적인 이미지 업데이트 및 재배포</li>
                    <li>Secrets을 환경 변수 대신 파일로 마운트</li>
                </ul>

                <h3>보안 강화된 Pod 명세 예시</h3>
                <div class="code-block">apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
  labels:
    app: secure-app
spec:
  serviceAccountName: my-app-sa
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
    seccompProfile:
      type: RuntimeDefault
  
  containers:
  - name: app
    image: 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:v1.2.3
    
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    
    volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: secrets
      mountPath: /etc/secrets
      readOnly: true
  
  volumes:
  - name: tmp
    emptyDir: {}
  - name: secrets
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "aws-secrets"</div>
            </section>

            <!-- Section 12: 자동화 및 IaC -->
            <section id="automation">
                <h2>12. 자동화 및 Infrastructure as Code</h2>
                
                <h3>보안 자동화의 중요성</h3>
                <div class="info-box">
                    <strong>DevSecOps 원칙:</strong> 보안을 개발 파이프라인의 모든 단계에 통합하여 "Shift Left" 접근 방식을 구현합니다.
                </div>

                <h3>Terraform 보안 베이스라인 모듈</h3>
                <div class="code-block"># modules/security-baseline/main.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# GuardDuty 활성화
resource "aws_guardduty_detector" "main" {
  enable                       = var.enable_guardduty
  finding_publishing_frequency = "FIFTEEN_MINUTES"
  
  datasources {
    s3_logs {
      enable = true
    }
    kubernetes {
      audit_logs {
        enable = true
      }
    }
    malware_protection {
      scan_ec2_instance_with_findings {
        ebs_volumes {
          enable = true
        }
      }
    }
  }

  tags = var.tags
}

# Security Hub 활성화
resource "aws_securityhub_account" "main" {
  count = var.enable_security_hub ? 1 : 0
}

resource "aws_securityhub_standards_subscription" "cis" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
}

resource "aws_securityhub_standards_subscription" "aws_foundational" {
  count         = var.enable_security_hub ? 1 : 0
  depends_on    = [aws_securityhub_account.main]
  standards_arn = "arn:aws:securityhub:${data.aws_region.current.name}::standards/aws-foundational-security-best-practices/v/1.0.0"
}

# AWS Config 활성화
resource "aws_config_configuration_recorder" "main" {
  name     = "security-config-recorder"
  role_arn = aws_iam_role.config.arn

  recording_group {
    all_supported = true
    include_global_resources = true
  }
}

resource "aws_config_delivery_channel" "main" {
  name           = "security-config-delivery"
  s3_bucket_name = aws_s3_bucket.config.bucket
  depends_on     = [aws_config_configuration_recorder.main]
}

resource "aws_config_configuration_recorder_status" "main" {
  name       = aws_config_configuration_recorder.main.name
  is_enabled = true
  depends_on = [aws_config_delivery_channel.main]
}

# CloudTrail 멀티 리전 추적
resource "aws_cloudtrail" "main" {
  name                          = var.cloudtrail_name
  s3_bucket_name                = aws_s3_bucket.cloudtrail.bucket
  include_global_service_events = true
  is_multi_region_trail         = true
  enable_log_file_validation    = true
  
  event_selector {
    read_write_type           = "All"
    include_management_events = true

    data_resource {
      type   = "AWS::S3::Object"
      values = ["arn:aws:s3:::"]
    }

    data_resource {
      type   = "AWS::Lambda::Function"
      values = ["arn:aws:lambda"]
    }
  }

  insight_selector {
    insight_type = "ApiCallRateInsight"
  }

  cloud_watch_logs_group_arn = "${aws_cloudwatch_log_group.cloudtrail.arn}:*"
  cloud_watch_logs_role_arn  = aws_iam_role.cloudtrail_cloudwatch.arn
  kms_key_id                 = aws_kms_key.cloudtrail.arn

  tags = var.tags
}

# S3 버킷 암호화 및 보안 설정
resource "aws_s3_bucket" "cloudtrail" {
  bucket = var.cloudtrail_bucket_name

  tags = var.tags
}

resource "aws_s3_bucket_versioning" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm     = "aws:kms"
      kms_master_key_id = aws_kms_key.cloudtrail.arn
    }
  }
}

resource "aws_s3_bucket_public_access_block" "cloudtrail" {
  bucket = aws_s3_bucket.cloudtrail.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

# 로그 보존 정책
resource "aws_cloudwatch_log_group" "cloudtrail" {
  name              = "/aws/cloudtrail/${var.cloudtrail_name}"
  retention_in_days = var.log_retention_days
  kms_key_id        = aws_kms_key.cloudwatch.arn

  tags = var.tags
}

# variables.tf
variable "enable_guardduty" {
  description = "Enable GuardDuty"
  type        = bool
  default     = true
}

variable "enable_security_hub" {
  description = "Enable Security Hub"
  type        = bool
  default     = true
}

variable "enable_config" {
  description = "Enable AWS Config"
  type        = bool
  default     = true
}

variable "cloudtrail_name" {
  description = "CloudTrail name"
  type        = string
  default     = "organization-trail"
}

variable "cloudtrail_bucket_name" {
  description = "S3 bucket for CloudTrail logs"
  type        = string
}

variable "log_retention_days" {
  description = "CloudWatch Logs retention in days"
  type        = number
  default     = 365
}

variable "tags" {
  description = "Tags to apply to resources"
  type        = map(string)
  default     = {}
}</div>

                <h3>사용 예시</h3>
                <div class="code-block"># main.tf
module "security_baseline" {
  source = "./modules/security-baseline"
  
  enable_guardduty    = true
  enable_security_hub = true
  enable_config       = true
  
  cloudtrail_name        = "production-audit-trail"
  cloudtrail_bucket_name = "my-org-cloudtrail-logs-123456789012"
  log_retention_days     = 365
  
  tags = {
    Environment = "Production"
    ManagedBy   = "Terraform"
    Compliance  = "PCI-DSS"
    CostCenter  = "Security"
  }
}</div>

                <h3>DevSecOps 파이프라인</h3>
                <div class="architecture-diagram">┌─────────────┐
│   Code      │  Git Commit
└─────────────┘
      ↓
┌─────────────┐
│   SAST      │  SonarQube, Semgrep
└─────────────┘  코드 정적 분석
      ↓
┌─────────────┐
│   Build     │  Docker Build
└─────────────┘
      ↓
┌─────────────┐
│   Scan      │  Trivy, Snyk, Grype
└─────────────┘  컨테이너 이미지 스캔
      ↓
┌─────────────┐
│   IaC Scan  │  Checkov, tfsec
└─────────────┘  인프라 코드 검증
      ↓
┌─────────────┐
│   Deploy    │  ArgoCD, Flux
└─────────────┘
      ↓
┌─────────────┐
│   DAST      │  OWASP ZAP
└─────────────┘  동적 애플리케이션 스캔
      ↓
┌─────────────┐
│   Monitor   │  GuardDuty, Falco
└─────────────┘  런타임 보안 모니터링</div>

                <h3>GitHub Actions 보안 파이프라인 예시</h3>
                <div class="code-block">name: Security Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    
    steps:
    # 코드 체크아웃
    - name: Checkout code
      uses: actions/checkout@v3

    # SAST - 정적 코드 분석
    - name: Run Semgrep
      uses: returntocorp/semgrep-action@v1
      with:
        config: >-
          p/security-audit
          p/secrets
          p/owasp-top-ten

    # Secrets 스캔
    - name: GitGuardian scan
      uses: GitGuardian/ggshield-action@v1
      env:
        GITHUB_PUSH_BEFORE_SHA: ${{ github.event.before }}
        GITHUB_PUSH_BASE_SHA: ${{ github.event.base }}
        GITHUB_DEFAULT_BRANCH: ${{ github.event.repository.default_branch }}
        GITGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN_API_KEY }}

    # 의존성 취약점 스캔
    - name: Run Snyk
      uses: snyk/actions/node@master
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      with:
        args: --severity-threshold=high

    # Docker 이미지 빌드
    - name: Build Docker image
      run: |
        docker build -t myapp:${{ github.sha }} .

    # 컨테이너 이미지 스캔
    - name: Run Trivy scanner
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'myapp:${{ github.sha }}'
        format: 'sarif'
        output: 'trivy-results.sarif'
        severity: 'CRITICAL,HIGH'

    # SARIF 결과를 GitHub Security에 업로드
    - name: Upload Trivy results to GitHub Security
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'

    # Terraform 보안 스캔
    - name: Run tfsec
      uses: aquasecurity/tfsec-action@v1.0.0
      with:
        soft_fail: false

    # Checkov - IaC 보안 스캔
    - name: Run Checkov
      uses: bridgecrewio/checkov-action@master
      with:
        directory: ./terraform
        framework: terraform
        output_format: sarif
        output_file_path: checkov-results.sarif

    # 모든 검사 통과 시 ECR에 푸시
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
        aws-region: us-east-1

    - name: Login to Amazon ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Push to ECR
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        ECR_REPOSITORY: myapp
        IMAGE_TAG: ${{ github.sha }}
      run: |
        docker tag myapp:$IMAGE_TAG $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG</div>

                <h3>정책 as Code (Policy as Code)</h3>
                <div class="code-block"># OPA Rego 정책 예시
# terraform_s3_encryption.rego

package terraform.s3

# S3 버킷은 반드시 암호화되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not resource.server_side_encryption_configuration
  msg := sprintf("S3 bucket '%s' must have encryption enabled", [name])
}

# 공개 액세스는 반드시 차단되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not input.resource.aws_s3_bucket_public_access_block[name]
  msg := sprintf("S3 bucket '%s' must have public access blocked", [name])
}

# 버전 관리는 반드시 활성화되어야 함
deny[msg] {
  resource := input.resource.aws_s3_bucket[name]
  not input.resource.aws_s3_bucket_versioning[name]
  msg := sprintf("S3 bucket '%s' must have versioning enabled", [name])
}</div>

                <h3>자동화 도구 비교</h3>
                <table>
                    <thead>
                        <tr>
                            <th>도구</th>
                            <th>용도</th>
                            <th>장점</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Terraform</td>
                            <td>IaC 프로비저닝</td>
                            <td>멀티 클라우드, 풍부한 생태계</td>
                        </tr>
                        <tr>
                            <td>CloudFormation</td>
                            <td>AWS 네이티브 IaC</td>
                            <td>AWS 서비스 빠른 지원</td>
                        </tr>
                        <tr>
                            <td>Checkov</td>
                            <td>IaC 보안 스캔</td>
                            <td>1000+ 내장 정책</td>
                        </tr>
                        <tr>
                            <td>tfsec</td>
                            <td>Terraform 보안</td>
                            <td>빠른 속도, CI/CD 통합</td>
                        </tr>
                        <tr>
                            <td>Trivy</td>
                            <td>이미지/IaC 스캔</td>
                            <td>올인원, 오픈소스</td>
                        </tr>
                        <tr>
                            <td>SonarQube</td>
                            <td>코드 품질/보안</td>
                            <td>상세한 분석, 대시보드</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Section 13: 지속적인 보안 개선 -->
            <section>
                <h2>13. 지속적인 보안 개선</h2>
                
                <h3>보안 성숙도 모델</h3>
                <table>
                    <thead>
                        <tr>
                            <th>레벨</th>
                            <th>설명</th>
                            <th>핵심 활동</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. 기본</td>
                            <td>최소한의 보안 통제</td>
                            <td>IAM, 암호화, CloudTrail</td>
                        </tr>
                        <tr>
                            <td>2. 관리</td>
                            <td>조직화된 보안 프로세스</td>
                            <td>GuardDuty, Config, 정책 문서화</td>
                        </tr>
                        <tr>
                            <td>3. 정의</td>
                            <td>표준화된 보안 절차</td>
                            <td>자동화, IaC, 정기 감사</td>
                        </tr>
                        <tr>
                            <td>4. 최적화</td>
                            <td>지속적 개선</td>
                            <td>머신러닝, 예측 분석</td>
                        </tr>
                        <tr>
                            <td>5. 혁신</td>
                            <td>업계 리더</td>
                            <td>Zero Trust, 자율 보안</td>
                        </tr>
                    </tbody>
                </table>

                <h3>정기 점검 체크리스트</h3>
                
                <h4>월간 점검</h4>
                <ul class="checklist">
                    <li>IAM 사용자 및 권한 검토</li>
                    <li>미사용 액세스 키 식별 및 제거</li>
                    <li>Security Hub 점수 확인</li>
                    <li>GuardDuty 발견사항 검토</li>
                    <li>비용 이상치 분석 (암호화폐 채굴 탐지)</li>
                </ul>

                <h4>분기별 점검</h4>
                <ul class="checklist">
                    <li>전체 Security Group 감사</li>
                    <li>Network ACL 규칙 검토</li>
                    <li>S3 버킷 공개 액세스 스캔</li>
                    <li>암호화 키 로테이션 확인</li>
                    <li>재해 복구 훈련 (Disaster Recovery Drill)</li>
                    <li>백업 복원 테스트</li>
                </ul>

                <h4>반기별 점검</h4>
                <ul class="checklist">
                    <li>침투 테스트 (Penetration Testing)</li>
                    <li>취약점 평가 (Vulnerability Assessment)</li>
                    <li>보안 정책 문서 업데이트</li>
                    <li>직원 보안 교육</li>
                    <li>사고 대응 플레이북 시뮬레이션</li>
                </ul>

                <h4>연간 점검</h4>
                <ul class="checklist">
                    <li>전체 아키텍쳐 보안 리뷰</li>
                    <li>외부 보안 감사</li>
                    <li>컴플라이언스 인증 갱신</li>
                    <li>보안 로드맵 수립</li>
                    <li>기술 부채 평가 및 개선 계획</li>
                </ul>

                <h3>보안 메트릭 (KPI)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>지표</th>
                            <th>측정 방법</th>
                            <th>목표</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>평균 탐지 시간 (MTTD)</td>
                            <td>위협 발생부터 탐지까지</td>
                            <td>&lt; 5분</td>
                        </tr>
                        <tr>
                            <td>평균 대응 시간 (MTTR)</td>
                            <td>탐지부터 완화까지</td>
                            <td>&lt; 15분</td>
                        </tr>
                        <tr>
                            <td>패치 적용 시간</td>
                            <td>CVE 공개부터 패치까지</td>
                            <td>&lt; 30일</td>
                        </tr>
                        <tr>
                            <td>미해결 보안 발견사항</td>
                            <td>Security Hub 미해결 건수</td>
                            <td>0 (Critical/High)</td>
                        </tr>
                        <tr>
                            <td>보안 교육 이수율</td>
                            <td>직원 교육 완료 비율</td>
                            <td>100%</td>
                        </tr>
                    </tbody>
                </table>

                <h3>보안 문화 구축</h3>
                <div class="success-box">
                    <strong>보안은 모든 사람의 책임입니다</strong>
                    <ul style="margin-top: 10px;">
                        <li><strong>교육</strong>: 정기적인 보안 인식 교육 실시</li>
                        <li><strong>공유</strong>: 보안 인시던트 학습 내용 전사 공유</li>
                        <li><strong>보상</strong>: 보안 취약점 발견 시 인센티브 제공</li>
                        <li><strong>투명성</strong>: 보안 메트릭을 공개하여 개선 동기 부여</li>
                        <li><strong>지원</strong>: 보안 챔피언 프로그램 운영</li>
                    </ul>
                </div>
            </section>

            <!-- Section 14: 참고 리소스 -->
            <section>
                <h2>14. 참고 리소스 및 문서</h2>
                
                <h3>AWS 공식 문서</h3>
                <ul>
                    <li><a href="https://aws.amazon.com/architecture/well-architected/" target="_blank">AWS Well-Architected Framework - Security Pillar</a></li>
                    <li><a href="https://docs.aws.amazon.com/security/" target="_blank">AWS Security Documentation</a></li>
                    <li><a href="https://aws.amazon.com/security/security-resources/" target="_blank">AWS Security Resources</a></li>
                    <li><a href="https://aws.amazon.com/compliance/" target="_blank">AWS Compliance Programs</a></li>
                </ul>

                <h3>보안 표준 및 프레임워크</h3>
                <ul>
                    <li><a href="https://www.cisecurity.org/benchmark/amazon_web_services" target="_blank">CIS AWS Foundations Benchmark</a></li>
                    <li><a href="https://www.nist.gov/cyberframework" target="_blank">NIST Cybersecurity Framework</a></li>
                    <li><a href="https://owasp.org/www-project-top-ten/" target="_blank">OWASP Top 10</a></li>
                    <li><a href="https://www.sans.org/cloud-security/" target="_blank">SANS Cloud Security</a></li>
                </ul>

                <h3>오픈소스 보안 도구</h3>
                <ul>
                    <li><a href="https://github.com/prowler-cloud/prowler" target="_blank">Prowler - AWS 보안 평가 도구</a></li>
                    <li><a href="https://github.com/bridgecrewio/checkov" target="_blank">Checkov - IaC 보안 스캐너</a></li>
                    <li><a href="https://github.com/aquasecurity/trivy" target="_blank">Trivy - 취약점 스캐너</a></li>
                    <li><a href="https://github.com/falcosecurity/falco" target="_blank">Falco - 런타임 보안</a></li>
                    <li><a href="https://github.com/tfsec/tfsec" target="_blank">tfsec - Terraform 보안</a></li>
                </ul>

                <h3>보안 블로그 및 뉴스</h3>
                <ul>
                    <li><a href="https://aws.amazon.com/blogs/security/" target="_blank">AWS Security Blog</a></li>
                    <li><a href="https://www.schneier.com/" target="_blank">Schneier on Security</a></li>
                    <li><a href="https://krebsonsecurity.com/" target="_blank">Krebs on Security</a></li>
                    <li><a href="https://threatpost.com/" target="_blank">Threatpost</a></li>
                </ul>

                <h3>AWS 보안 서비스 요약</h3>
                <table>
                    <thead>
                        <tr>
                            <th>서비스</th>
                            <th>카테고리</th>
                            <th>주요 기능</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>IAM</td>
                            <td>접근 관리</td>
                            <td>사용자 및 권한 관리</td>
                        </tr>
                        <tr>
                            <td>GuardDuty</td>
                            <td>위협 탐지</td>
                            <td>지능형 위협 탐지</td>
                        </tr>
                        <tr>
                            <td>Security Hub</td>
                            <td>보안 통합</td>
                            <td>통합 보안 대시보드</td>
                        </tr>
                        <tr>
                            <td>Inspector</td>
                            <td>취약점 평가</td>
                            <td>자동화된 보안 평가</td>
                        </tr>
                        <tr>
                            <td>Macie</td>
                            <td>데이터 보호</td>
                            <td>민감 데이터 검색</td>
                        </tr>
                        <tr>
                            <td>WAF</td>
                            <td>애플리케이션 보호</td>
                            <td>웹 애플리케이션 방화벽</td>
                        </tr>
                        <tr>
                            <td>Shield</td>
                            <td>DDoS 방어</td>
                            <td>DDoS 공격 방어</td>
                        </tr>
                        <tr>
                            <td>KMS</td>
                            <td>암호화</td>
                            <td>키 관리 서비스</td>
                        </tr>
                        <tr>
                            <td>Secrets Manager</td>
                            <td>시크릿 관리</td>
                            <td>자격 증명 안전 저장</td>
                        </tr>
                        <tr>
                            <td>CloudTrail</td>
                            <td>감사</td>
                            <td>API 호출 기록</td>
                        </tr>
                        <tr>
                            <td>Config</td>
                            <td>규정 준수</td>
                            <td>리소스 구성 추적</td>
                        </tr>
                        <tr>
                            <td>Detective</td>
                            <td>조사</td>
                            <td>보안 사고 분석</td>
                        </tr>
                    </tbody>
                </table>
            </section>

        </main>

        <footer>
            <p>&copy; 2024 AWS Security Architecture Guide</p>
            <p>이 문서는 교육 목적으로 작성되었습니다. 실제 환경에 적용 시 조직의 요구사항에 맞게 조정하세요.</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                <strong>연락처:</strong> security@example.com | 
                <strong>버전:</strong> 1.0 | 
                <strong>최종 업데이트:</strong> 2024
            </p>
        </footer>
    </div>

    <a href="#" class="back-to-top">↑</a>

    <script>
        // 부드러운 스크롤
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Back to top 버튼 표시/숨김
        const backToTopButton = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.style.display = 'flex';
            } else {
                backToTopButton.style.display = 'none';
            }
        });

        // 초기 상태
        backToTopButton.style.display = 'none';
    </script>
</body>
</html>
```

주요 개선사항:

## ✨ 코드 블록 가독성 개선

1. **폰트 변경**: `Consolas`, `Monaco` 등 가독성 좋은 모노스페이스 폰트 사용
2. **폰트 크기**: 14px로 적절하게 조정
3. **줄 간격**: `line-height: 1.6`으로 넉넉하게 설정
4. **배경색**: 더 어두운 `#1e1e1e` VS Code 스타일
5. **스크롤바 스타일**: 오렌지색 커스텀 스크롤바
6. **여백**: 충분한 패딩으로 가독성 향상
7. **왼쪽 테두리**: 주황색 강조선 추가

코드가 이제 여러 줄로 보기 좋게 표시됩니다! 추가 조정이 필요하시면 말씀해주세요.
